<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shape Fitter - Free HTML5 Puzzle Game | GamesZone99.com</title>
    <meta name="description" content="Play Shape Fitter for free! Drag and drop shapes to fit them perfectly in this addictive puzzle game. Mobile-friendly browser game with no download required.">
    <meta name="keywords" content="shape fitter, puzzle game, html5 game, free online game, browser game, mobile game, tetris shapes, drag drop">
    <meta name="author" content="GamesZone99">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="game">
    <meta property="og:url" content="https://gameszone99.com/shape-fitter.html">
    <meta property="og:title" content="Shape Fitter - Free HTML5 Puzzle Game">
    <meta property="og:description" content="Drag and drop shapes to fit them perfectly in this addictive puzzle game!">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://gameszone99.com/shape-fitter.html">
    <meta property="twitter:title" content="Shape Fitter - Free HTML5 Puzzle Game">
    <meta property="twitter:description" content="Drag and drop shapes to fit them perfectly in this addictive puzzle game!">

    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --dark-gradient: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 100%);
            --accent-color: #00d4ff;
            --success-color: #00ff88;
            --warning-color: #ffaa00;
            --text-primary: #ffffff;
            --text-secondary: #b8c1ec;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --shadow-glow: 0 0 40px rgba(0, 212, 255, 0.3);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: "Inter", sans-serif;
            background: var(--dark-gradient);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Ad Containers */
        .ad-container-top, .ad-container-bottom {
            width: 100%;
            min-height: 90px;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid var(--card-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .ad-placeholder {
            width: 728px;
            height: 90px;
            background: linear-gradient(45deg, #333, #555);
            border: 2px dashed #666;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .ad-placeholder {
                width: 320px;
                height: 50px;
                font-size: 12px;
            }
        }

        /* Header */
        .header {
            padding: 1rem 0;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--card-border);
            text-align: center;
        }

        .game-title-header {
            font-family: "Orbitron", monospace;
            font-size: 2.5rem;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            text-shadow: var(--shadow-glow);
        }

        .game-description {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Main Content */
        .content-wrapper {
            display: flex;
            flex: 1;
            gap: 2rem;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Game Stats */
        .game-stats {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .stat-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            text-align: center;
            min-width: 120px;
            box-shadow: var(--shadow-card);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-color);
            font-family: "Orbitron", monospace;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Game Container */
        .game-container {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-card);
            position: relative;
            overflow: hidden;
        }

        .game-area {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            aspect-ratio: 1;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 15px;
            border: 2px solid var(--card-border);
            overflow: hidden;
        }

        #gameBoard {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 2px;
            padding: 10px;
            height: 100%;
            width: 100%;
        }

        .grid-cell {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
        }

        .grid-cell.filled {
            background: var(--accent-color);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .grid-cell.highlight {
            background: rgba(0, 212, 255, 0.3);
        }

        /* Shapes Container */
        .shapes-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .shape {
            cursor: grab;
            padding: 10px;
            border-radius: 8px;
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            transition: all 0.2s ease;
            user-select: none;
        }

        .shape:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-glow);
        }

        .shape.dragging {
            cursor: grabbing;
            opacity: 0.8;
            transform: scale(1.1);
            z-index: 1000;
            position: fixed;
            pointer-events: none;
        }

        .shape-grid {
            display: grid;
            gap: 2px;
        }

        .shape-cell {
            width: 20px;
            height: 20px;
            border-radius: 2px;
        }

        .shape-cell.filled {
            background: var(--success-color);
        }

        .shape-cell.empty {
            background: transparent;
        }

        /* Start Button */
        .start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            z-index: 10;
        }

        .start-button {
            background: var(--primary-gradient);
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "Orbitron", monospace;
            box-shadow: var(--shadow-glow);
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 212, 255, 0.4);
        }

        /* Control Buttons */
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .control-btn {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: var(--accent-color);
            color: #000;
            transform: translateY(-2px);
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 1rem;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .mobile-control {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-primary);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .mobile-control:active {
            background: var(--accent-color);
            transform: scale(0.95);
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .sidebar-section {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--shadow-card);
        }

        .sidebar-title {
            color: var(--accent-color);
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .instructions {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .instructions ul {
            margin-left: 1rem;
            margin-top: 0.5rem;
        }

        .instructions li {
            margin-bottom: 0.5rem;
        }

        /* Game Over Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--dark-gradient);
            border: 2px solid var(--card-border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-glow);
        }

        .modal h2 {
            color: var(--accent-color);
            margin-bottom: 1rem;
            font-family: "Orbitron", monospace;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .modal-btn {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        .modal-btn.secondary {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .content-wrapper {
                flex-direction: column;
                padding: 1rem;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .game-title-header {
                font-size: 2rem;
            }
        }

        @media (max-width: 768px) {
            .mobile-controls {
                display: grid;
            }
            
            .control-buttons {
                display: none;
            }
            
            .game-container {
                padding: 1rem;
            }
            
            .game-stats {
                gap: 0.5rem;
            }
            
            .stat-card {
                min-width: 100px;
                padding: 0.75rem 1rem;
            }
            
            .shape-cell {
                width: 15px;
                height: 15px;
            }
        }

        @media (max-width: 480px) {
            .game-title-header {
                font-size: 1.5rem;
            }
            
            .content-wrapper {
                padding: 0.5rem;
            }
            
            .shape-cell {
                width: 12px;
                height: 12px;
            }
        }

        /* Loading Animation */
        .loading {
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        /* Pulse Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <!-- Top Ad Container -->
    <div class="ad-container-top">
        <div class="ad-placeholder">728x90 Header Advertisement</div>
    </div>

    <!-- Header -->
    <header class="header">
        <h1 class="game-title-header">🔷 Shape Fitter</h1>
        <p class="game-description">Drag and drop shapes to fit them perfectly in the grid. Challenge your spatial skills!</p>
    </header>

    <!-- Main Content -->
    <div class="content-wrapper">
        <main class="main-content loading">
            <!-- Game Stats -->
            <div class="game-stats">
                <div class="stat-card">
                    <div class="stat-value" id="score">0</div>
                    <div class="stat-label">Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="bestScore">0</div>
                    <div class="stat-label">Best</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="shapesPlaced">0</div>
                    <div class="stat-label">Shapes</div>
                </div>
            </div>

            <!-- Game Container -->
            <div class="game-container">
                <div class="game-area">
                    <div class="start-overlay" id="startOverlay">
                        <button class="start-button" onclick="startGame()">🎯 Start Game</button>
                    </div>
                    <div id="gameBoard"></div>
                </div>
                
                <div class="shapes-container" id="shapesContainer">
                    <!-- Shapes will be generated here -->
                </div>

                <div class="control-buttons">
                    <button class="control-btn" onclick="newGame()">🆕 New Game</button>
                    <button class="control-btn" onclick="togglePause()">⏸️ Pause</button>
                    <button class="control-btn" onclick="showInstructions()">❓ Help</button>
                    <button class="control-btn" onclick="showHighScores()">🏆 Scores</button>
                </div>

                <div class="mobile-controls">
                    <div class="mobile-control" onclick="rotateShape()">🔄</div>
                    <div class="mobile-control" onclick="showInstructions()">❓</div>
                    <div class="mobile-control" onclick="newGame()">🆕</div>
                </div>
            </div>
        </main>

        <!-- Sidebar -->
        <aside class="sidebar loading">
            <div class="sidebar-section">
                <h3 class="sidebar-title">🎯 How to Play</h3>
                <div class="instructions">
                    <p><strong>Drag and drop shapes to fit them perfectly in the grid!</strong></p>
                    <ul>
                        <li>Drag shapes from the bottom area</li>
                        <li>Drop them on the grid to place</li>
                        <li>Fill complete rows/columns to clear them</li>
                        <li>Get points for each shape placed</li>
                        <li>Game ends when no shapes can fit</li>
                        <li>Beat your high score!</li>
                    </ul>
                </div>
            </div>

            <div class="sidebar-section" style="min-height: 250px; display: flex; align-items: center; justify-content: center;">
                <div style="width: 250px; height: 250px; background: linear-gradient(45deg, #333, #555); border: 2px dashed #666; display: flex; align-items: center; justify-content: center; color: #999; font-size: 14px; border-radius: 8px; text-align: center;">
                    250x250<br>Sidebar Ad
                </div>
            </div>
        </aside>
    </div>

    <!-- Bottom Ad Container -->
    <div class="ad-container-bottom">
        <div class="ad-placeholder">728x90 Footer Advertisement</div>
    </div>

    <!-- Game Over Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2>🎮 Game Over!</h2>
            <p>Your Score: <span id="finalScore">0</span></p>
            <p>Best Score: <span id="modalBestScore">0</span></p>
            <p id="newRecordText" style="color: var(--success-color); display: none;">🎉 New High Score!</p>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="playAgain()">🚀 Play Again</button>
                <button class="modal-btn secondary" onclick="shareScore()">📤 Share</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const game = {
            board: Array(10).fill().map(() => Array(10).fill(0)),
            score: 0,
            level: 1,
            shapesPlaced: 0,
            bestScore: localStorage.getItem("shapeFitterBest") || 0,
            currentShapes: [],
            gameRunning: false,
            gameStarted: false,
            draggedShape: null,
            dragOffset: { x: 0, y: 0 }
        };

        // Shape Patterns (Tetris-like shapes)
        const shapePatterns = [
            // I-Shape
            [[1, 1, 1, 1]],
            [[1], [1], [1], [1]],
            
            // O-Shape  
            [[1, 1], [1, 1]],
            
            // T-Shape
            [[1, 1, 1], [0, 1, 0]],
            [[0, 1], [1, 1], [0, 1]],
            [[0, 1, 0], [1, 1, 1]],
            [[1, 0], [1, 1], [1, 0]],
            
            // L-Shape
            [[1, 0], [1, 0], [1, 1]],
            [[1, 1, 1], [1, 0, 0]],
            [[1, 1], [0, 1], [0, 1]],
            [[0, 0, 1], [1, 1, 1]],
            
            // J-Shape
            [[0, 1], [0, 1], [1, 1]],
            [[1, 0, 0], [1, 1, 1]],
            [[1, 1], [1, 0], [1, 0]],
            [[1, 1, 1], [0, 0, 1]],
            
            // S-Shape
            [[0, 1, 1], [1, 1, 0]],
            [[1, 0], [1, 1], [0, 1]],
            
            // Z-Shape
            [[1, 1, 0], [0, 1, 1]],
            [[0, 1], [1, 1], [1, 0]],
            
            // Single block
            [[1]],
            
            // 2x1 block
            [[1, 1]],
            [[1], [1]],
            
            // 3x1 block
            [[1, 1, 1]],
            [[1], [1], [1]],
            
            // Small L
            [[1, 1], [1, 0]],
            [[1, 0], [1, 1]],
            [[0, 1], [1, 1]],
            [[1, 1], [0, 1]]
        ];

        // Initialize Game
        function initGame() {
            // Load best score
            document.getElementById("bestScore").textContent = game.bestScore;
            
            // Create game board
            createBoard();
            
            // Setup event listeners
            setupEventListeners();
            
            // Animate elements
            setTimeout(() => {
                document.querySelectorAll(".loading").forEach(el => {
                    el.style.opacity = "1";
                });
            }, 100);
        }

        // Create Game Board
        function createBoard() {
            const board = document.getElementById("gameBoard");
            board.innerHTML = "";
            
            for (let row = 0; row < 10; row++) {
                for (let col = 0; col < 10; col++) {
                    const cell = document.createElement("div");
                    cell.className = "grid-cell";
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    board.appendChild(cell);
                }
            }
        }

        // Generate Random Shapes
        function generateShapes() {
            game.currentShapes = [];
            const shapesContainer = document.getElementById("shapesContainer");
            shapesContainer.innerHTML = "";
            
            for (let i = 0; i < 3; i++) {
                const pattern = shapePatterns[Math.floor(Math.random() * shapePatterns.length)];
                const shape = {
                    id: Date.now() + i,
                    pattern: pattern,
                    used: false
                };
                
                game.currentShapes.push(shape);
                createShapeElement(shape);
            }
        }

        // Create Shape Element
        function createShapeElement(shape) {
            const shapesContainer = document.getElementById("shapesContainer");
            const shapeDiv = document.createElement("div");
            shapeDiv.className = "shape";
            shapeDiv.dataset.shapeId = shape.id;
            
            const shapeGrid = document.createElement("div");
            shapeGrid.className = "shape-grid";
            shapeGrid.style.gridTemplateColumns = `repeat(${shape.pattern[0].length}, 1fr)`;
            shapeGrid.style.gridTemplateRows = `repeat(${shape.pattern.length}, 1fr)`;
            
            shape.pattern.forEach(row => {
                row.forEach(cell => {
                    const cellDiv = document.createElement("div");
                    cellDiv.className = `shape-cell ${cell ? 'filled' : 'empty'}`;
                    shapeGrid.appendChild(cellDiv);
                });
            });
            
            shapeDiv.appendChild(shapeGrid);
            shapesContainer.appendChild(shapeDiv);
            
            // Add drag event listeners
            setupShapeDrag(shapeDiv, shape);
        }

        // Setup Shape Drag
        function setupShapeDrag(shapeElement, shape) {
            let isDragging = false;
            
            // Mouse events
            shapeElement.addEventListener("mousedown", startDrag);
            document.addEventListener("mousemove", drag);
            document.addEventListener("mouseup", endDrag);
            
            // Touch events
            shapeElement.addEventListener("touchstart", startDragTouch, { passive: false });
            document.addEventListener("touchmove", dragTouch, { passive: false });
            document.addEventListener("touchend", endDragTouch);
            
            function startDrag(e) {
                if (shape.used || !game.gameRunning) return;
                
                isDragging = true;
                game.draggedShape = shape;
                
                const rect = shapeElement.getBoundingClientRect();
                game.dragOffset.x = e.clientX - rect.left;
                game.dragOffset.y = e.clientY - rect.top;
                
                shapeElement.classList.add("dragging");
                e.preventDefault();
            }
            
            function startDragTouch(e) {
                if (shape.used || !game.gameRunning) return;
                
                const touch = e.touches[0];
                const rect = shapeElement.getBoundingClientRect();
                
                isDragging = true;
                game.draggedShape = shape;
                game.dragOffset.x = touch.clientX - rect.left;
                game.dragOffset.y = touch.clientY - rect.top;
                
                shapeElement.classList.add("dragging");
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging || !game.draggedShape) return;
                
                shapeElement.style.left = (e.clientX - game.dragOffset.x) + "px";
                shapeElement.style.top = (e.clientY - game.dragOffset.y) + "px";
                
                highlightValidPositions(e.clientX, e.clientY);
            }
            
            function dragTouch(e) {
                if (!isDragging || !game.draggedShape) return;
                
                const touch = e.touches[0];
                shapeElement.style.left = (touch.clientX - game.dragOffset.x) + "px";
                shapeElement.style.top = (touch.clientY - game.dragOffset.y) + "px";
                
                highlightValidPositions(touch.clientX, touch.clientY);
                e.preventDefault();
            }
            
            function endDrag(e) {
                if (!isDragging) return;
                
                isDragging = false;
                shapeElement.classList.remove("dragging");
                shapeElement.style.left = "";
                shapeElement.style.top = "";
                
                const dropResult = attemptDrop(e.clientX, e.clientY);
                if (dropResult) {
                    placeShape(shape, dropResult.row, dropResult.col);
                }
                
                clearHighlights();
                game.draggedShape = null;
            }
            
            function endDragTouch(e) {
                if (!isDragging) return;
                
                isDragging = false;
                shapeElement.classList.remove("dragging");
                shapeElement.style.left = "";
                shapeElement.style.top = "";
                
                const touch = e.changedTouches[0];
               const dropResult = attemptDrop(touch.clientX, touch.clientY);
               if (dropResult) {
                   placeShape(shape, dropResult.row, dropResult.col);
               }
               
               clearHighlights();
               game.draggedShape = null;
           }
       }

       // Highlight Valid Positions
       function highlightValidPositions(x, y) {
           clearHighlights();
           
           if (!game.draggedShape) return;
           
           const boardElement = document.getElementById("gameBoard");
           const boardRect = boardElement.getBoundingClientRect();
           
           if (x < boardRect.left || x > boardRect.right || 
               y < boardRect.top || y > boardRect.bottom) {
               return;
           }
           
           const cellSize = boardRect.width / 10;
           const col = Math.floor((x - boardRect.left) / cellSize);
           const row = Math.floor((y - boardRect.top) / cellSize);
           
           if (canPlaceShape(game.draggedShape, row, col)) {
               highlightShapePosition(game.draggedShape, row, col);
           }
       }

       // Attempt Drop
       function attemptDrop(x, y) {
           const boardElement = document.getElementById("gameBoard");
           const boardRect = boardElement.getBoundingClientRect();
           
           if (x < boardRect.left || x > boardRect.right || 
               y < boardRect.top || y > boardRect.bottom) {
               return null;
           }
           
           const cellSize = boardRect.width / 10;
           const col = Math.floor((x - boardRect.left) / cellSize);
           const row = Math.floor((y - boardRect.top) / cellSize);
           
           if (canPlaceShape(game.draggedShape, row, col)) {
               return { row, col };
           }
           
           return null;
       }

       // Check if Shape Can Be Placed
       function canPlaceShape(shape, startRow, startCol) {
           const pattern = shape.pattern;
           
           for (let row = 0; row < pattern.length; row++) {
               for (let col = 0; col < pattern[row].length; col++) {
                   if (pattern[row][col]) {
                       const boardRow = startRow + row;
                       const boardCol = startCol + col;
                       
                       if (boardRow < 0 || boardRow >= 10 || 
                           boardCol < 0 || boardCol >= 10 || 
                           game.board[boardRow][boardCol]) {
                           return false;
                       }
                   }
               }
           }
           return true;
       }

       // Highlight Shape Position
       function highlightShapePosition(shape, startRow, startCol) {
           const pattern = shape.pattern;
           
           for (let row = 0; row < pattern.length; row++) {
               for (let col = 0; col < pattern[row].length; col++) {
                   if (pattern[row][col]) {
                       const boardRow = startRow + row;
                       const boardCol = startCol + col;
                       
                       if (boardRow >= 0 && boardRow < 10 && 
                           boardCol >= 0 && boardCol < 10) {
                           const cell = document.querySelector(`[data-row="${boardRow}"][data-col="${boardCol}"]`);
                           if (cell) {
                               cell.classList.add("highlight");
                           }
                       }
                   }
               }
           }
       }

       // Clear Highlights
       function clearHighlights() {
           document.querySelectorAll(".grid-cell").forEach(cell => {
               cell.classList.remove("highlight");
           });
       }

       // Place Shape on Board
       function placeShape(shape, startRow, startCol) {
           const pattern = shape.pattern;
           
           // Place shape on board
           for (let row = 0; row < pattern.length; row++) {
               for (let col = 0; col < pattern[row].length; col++) {
                   if (pattern[row][col]) {
                       const boardRow = startRow + row;
                       const boardCol = startCol + col;
                       game.board[boardRow][boardCol] = 1;
                       
                       const cell = document.querySelector(`[data-row="${boardRow}"][data-col="${boardCol}"]`);
                       if (cell) {
                           cell.classList.add("filled");
                       }
                   }
               }
           }
           
           // Mark shape as used
           shape.used = true;
           const shapeElement = document.querySelector(`[data-shape-id="${shape.id}"]`);
           if (shapeElement) {
               shapeElement.style.opacity = "0.3";
               shapeElement.style.pointerEvents = "none";
           }
           
           // Update score
           const shapeSize = pattern.flat().filter(cell => cell).length;
           game.score += shapeSize * 10;
           game.shapesPlaced++;
           
           // Check for completed lines
           checkCompletedLines();
           
           // Update display
           updateDisplay();
           
           // Check if all shapes are used
           if (game.currentShapes.every(s => s.used)) {
               generateShapes();
               game.level++;
           }
           
           // Check game over
           checkGameOver();
           
           // Analytics
           trackEvent("shape_placed", { 
               score: game.score, 
               level: game.level,
               shapeSize: shapeSize 
           });
       }

       // Check Completed Lines
       function checkCompletedLines() {
           const completedRows = [];
           const completedCols = [];
           
           // Check rows
           for (let row = 0; row < 10; row++) {
               if (game.board[row].every(cell => cell === 1)) {
                   completedRows.push(row);
               }
           }
           
           // Check columns
           for (let col = 0; col < 10; col++) {
               if (game.board.every(row => row[col] === 1)) {
                   completedCols.push(col);
               }
           }
           
           // Clear completed lines
           completedRows.forEach(row => {
               for (let col = 0; col < 10; col++) {
                   game.board[row][col] = 0;
                   const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                   if (cell) {
                       cell.classList.remove("filled");
                       cell.style.animation = "pulse 0.5s ease";
                   }
               }
           });
           
           completedCols.forEach(col => {
               for (let row = 0; row < 10; row++) {
                   game.board[row][col] = 0;
                   const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                   if (cell) {
                       cell.classList.remove("filled");
                       cell.style.animation = "pulse 0.5s ease";
                   }
               }
           });
           
           // Add bonus score
           const linesCleared = completedRows.length + completedCols.length;
           if (linesCleared > 0) {
               game.score += linesCleared * 100;
               trackEvent("lines_cleared", { lines: linesCleared, score: game.score });
           }
       }

       // Check Game Over
       function checkGameOver() {
           const availableShapes = game.currentShapes.filter(s => !s.used);
           
           for (const shape of availableShapes) {
               for (let row = 0; row < 10; row++) {
                   for (let col = 0; col < 10; col++) {
                       if (canPlaceShape(shape, row, col)) {
                           return false; // Game can continue
                       }
                   }
               }
           }
           
           // No moves available
           endGame();
           return true;
       }

       // Start Game
       function startGame() {
           document.getElementById("startOverlay").style.display = "none";
           game.gameRunning = true;
           game.gameStarted = true;
           
           resetGame();
           generateShapes();
           updateDisplay();
           
           trackEvent("game_start");
       }

       // Reset Game
       function resetGame() {
           game.board = Array(10).fill().map(() => Array(10).fill(0));
           game.score = 0;
           game.level = 1;
           game.shapesPlaced = 0;
           game.currentShapes = [];
           
           // Clear board display
           document.querySelectorAll(".grid-cell").forEach(cell => {
               cell.classList.remove("filled", "highlight");
           });
           
           // Clear shapes
           document.getElementById("shapesContainer").innerHTML = "";
       }

       // New Game
       function newGame() {
           if (game.gameRunning) {
               if (!confirm("Are you sure you want to start a new game?")) {
                   return;
               }
           }
           
           document.getElementById("startOverlay").style.display = "flex";
           game.gameRunning = false;
           game.gameStarted = false;
           
           trackEvent("new_game");
       }

       // End Game
       function endGame() {
           game.gameRunning = false;
           
           // Check for new high score
           let isNewRecord = false;
           if (game.score > game.bestScore) {
               game.bestScore = game.score;
               localStorage.setItem("shapeFitterBest", game.bestScore);
               isNewRecord = true;
           }
           
           // Save score to history
           saveScore(game.score);
           
           // Show game over modal
           document.getElementById("finalScore").textContent = game.score.toLocaleString();
           document.getElementById("modalBestScore").textContent = game.bestScore.toLocaleString();
           
           if (isNewRecord) {
               document.getElementById("newRecordText").style.display = "block";
           } else {
               document.getElementById("newRecordText").style.display = "none";
           }
           
           document.getElementById("gameOverModal").style.display = "flex";
           
           trackEvent("game_over", { 
               score: game.score, 
               level: game.level,
               shapesPlaced: game.shapesPlaced,
               newRecord: isNewRecord 
           });
       }

       // Toggle Pause
       function togglePause() {
           if (!game.gameStarted) return;
           
           game.gameRunning = !game.gameRunning;
           
           if (game.gameRunning) {
               document.getElementById("startOverlay").style.display = "none";
           } else {
               document.getElementById("startOverlay").innerHTML = '<button class="start-button" onclick="togglePause()">▶️ Resume</button>';
               document.getElementById("startOverlay").style.display = "flex";
           }
       }

       // Update Display
       function updateDisplay() {
           document.getElementById("score").textContent = game.score.toLocaleString();
           document.getElementById("level").textContent = game.level;
           document.getElementById("bestScore").textContent = game.bestScore.toLocaleString();
           document.getElementById("shapesPlaced").textContent = game.shapesPlaced;
       }

       // Setup Event Listeners
       function setupEventListeners() {
           // Keyboard controls
           document.addEventListener("keydown", (e) => {
               if (e.code === "Space") {
                   e.preventDefault();
                   togglePause();
               } else if (e.code === "KeyN") {
                   e.preventDefault();
                   newGame();
               } else if (e.code === "KeyH") {
                   e.preventDefault();
                   showInstructions();
               }
           });
           
           // Close modal on click outside
           document.getElementById("gameOverModal").addEventListener("click", (e) => {
               if (e.target.id === "gameOverModal") {
                   closeModal();
               }
           });
       }

       // Play Again
       function playAgain() {
           closeModal();
           startGame();
       }

       // Close Modal
       function closeModal() {
           document.getElementById("gameOverModal").style.display = "none";
       }

       // Save Score
       function saveScore(score) {
           let scores = JSON.parse(localStorage.getItem("shapeFitterScores") || "[]");
           scores.push({
               score: score,
               date: new Date().toISOString(),
               level: game.level,
               shapes: game.shapesPlaced
           });
           scores.sort((a, b) => b.score - a.score);
           scores = scores.slice(0, 10); // Keep top 10
           localStorage.setItem("shapeFitterScores", JSON.stringify(scores));
       }

       // Show High Scores
       function showHighScores() {
           const scores = JSON.parse(localStorage.getItem("shapeFitterScores") || "[]");
           let message = "🏆 HIGH SCORES 🏆\n\n";
           
           if (scores.length === 0) {
               message += "No scores yet!\nBe the first!";
           } else {
               scores.slice(0, 5).forEach((score, index) => {
                   const date = new Date(score.date).toLocaleDateString();
                   message += `#${index + 1}: ${score.score.toLocaleString()} pts\n`;
                   message += `Level ${score.level} • ${score.shapes} shapes • ${date}\n\n`;
               });
           }
           
           alert(message);
       }

       // Show Instructions
       function showInstructions() {
           alert(`🎯 Shape Fitter - How to Play

🕹️ Controls:
- Drag shapes from bottom area
- Drop them on the grid to place
- Spacebar to pause/resume
- N for new game
- H for help

🎮 Gameplay:
- Drag and drop shapes to fit them in the grid
- Fill complete rows or columns to clear them
- Score points for each shape placed
- Bonus points for clearing lines
- Game ends when no shapes can fit
- Beat your high score!

🏆 Scoring:
- 10 points per block placed
- 100 bonus points per line cleared
- Higher levels = more challenging shapes

Good luck! 🍀`);
       }

       // Share Score
       function shareScore() {
           const text = `🎮 I just scored ${game.score.toLocaleString()} points in Shape Fitter! Level ${game.level} with ${game.shapesPlaced} shapes placed. Can you beat my score? 🏆`;
           
           if (navigator.share) {
               navigator.share({
                   title: "Shape Fitter - My Score",
                   text: text,
                   url: window.location.href
               });
           } else {
               navigator.clipboard.writeText(text + " " + window.location.href).then(() => {
                   alert("Score copied to clipboard! Share it with your friends!");
               }).catch(() => {
                   alert("Share: " + text);
               });
           }
       }

       // Rotate Shape (Mobile)
       function rotateShape() {
           // For future implementation - shape rotation
           alert("Shape rotation coming soon!");
       }

       // Analytics Event Tracking
       function trackEvent(eventName, data = {}) {
           // Google Analytics 4 event tracking
           if (typeof gtag !== 'undefined') {
               gtag('event', eventName, {
                   game_name: 'shape_fitter',
                   ...data
               });
           }
           
           // Console log for development
           console.log('Event:', eventName, data);
       }

       // Initialize game when page loads
       document.addEventListener("DOMContentLoaded", () => {
           initGame();
       });

       // Service Worker Registration for PWA
       if ('serviceWorker' in navigator) {
           window.addEventListener('load', () => {
               navigator.serviceWorker.register('/sw.js')
                   .then((registration) => {
                       console.log('SW registered: ', registration);
                   })
                   .catch((registrationError) => {
                       console.log('SW registration failed: ', registrationError);
                   });
           });
       }
   </script>

   <!-- Google Analytics 4 -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
   <script>
       window.dataLayer = window.dataLayer || [];
       function gtag(){dataLayer.push(arguments);}
       gtag('js', new Date());
       gtag('config', 'GA_MEASUREMENT_ID');
   </script>

   <!-- AdSense Auto Ads -->
   <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID" crossorigin="anonymous"></script>
   <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
   </script>
</body>
</html>