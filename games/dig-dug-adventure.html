<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèóÔ∏è Dig Dug Adventure - Underground Treasure Hunt | GamesZone99</title>
    <meta name="description" content="Play Dig Dug Adventure - Classic arcade digging game with treasures, enemies, and power-ups! Mobile-friendly browser game with touch controls.">
    <meta name="keywords" content="dig dug, underground game, arcade game, html5 game, mobile game, browser game, treasure hunt, digging game">
    <meta name="author" content="GamesZone99">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="game">
    <meta property="og:url" content="https://gameszone99.com/games/dig-dug-adventure.html">
    <meta property="og:title" content="üèóÔ∏è Dig Dug Adventure - Underground Treasure Hunt">
    <meta property="og:description" content="Classic arcade digging game with treasures, enemies, and power-ups!">
    <meta property="og:image" content="https://gameszone99.com/assets/dig-dug-adventure-og.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://gameszone99.com/games/dig-dug-adventure.html">
    <meta property="twitter:title" content="üèóÔ∏è Dig Dug Adventure - Underground Treasure Hunt">
    <meta property="twitter:description" content="Classic arcade digging game with treasures, enemies, and power-ups!">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #06d6a0;
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a3e;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --primary-gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --accent-gradient: linear-gradient(135deg, var(--accent-color), #059669);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Ad Containers */
        .ad-container-top,
        .ad-container-bottom {
            width: 100%;
            background: var(--bg-secondary);
            border: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 90px;
        }

        .ad-placeholder {
            color: var(--text-secondary);
            font-size: 14px;
            text-align: center;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--card-border);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            min-height: 80px;
        }

        .game-title {
            font-family: "Orbitron", monospace;
            font-size: 2rem;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-button {
            padding: 10px 20px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 25px;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 0.9rem;
        }

        .nav-button:hover {
            background: var(--accent-color);
            color: #000;
            transform: translateY(-2px);
        }

        /* Game Container */
        .game-container {
            flex: 1;
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            gap: 2rem;
            width: 100%;
        }

        .game-section {
            flex: 2;
            min-width: 320px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .stats-section {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .stat-box {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            padding: 0.8rem 1rem;
            text-align: center;
            backdrop-filter: blur(10px);
            min-width: 80px;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .game-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .control-button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-button.new-game {
            background: var(--accent-gradient);
            color: #000;
        }

        .control-button.pause {
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--card-border);
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .control-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Game Canvas */
        .game-canvas-container {
            position: relative;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 15px;
            padding: 1rem;
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1rem;
        }

        #gameCanvas {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            background: #2F4F2F;
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            justify-content: center;
            margin-top: 1rem;
        }

        .mobile-control-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 200px;
        }

        .mobile-control {
            width: 60px;
            height: 60px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            user-select: none;
        }

        .mobile-control:hover {
            background: var(--accent-color);
            color: #000;
            transform: scale(1.05);
        }

        .mobile-control:active {
            transform: scale(0.95);
        }

        .mobile-control.empty {
            visibility: hidden;
        }

        .mobile-control:nth-child(2) { grid-column: 2; grid-row: 1; }
        .mobile-control:nth-child(3) { grid-column: 1; grid-row: 2; }
        .mobile-control:nth-child(4) { grid-column: 3; grid-row: 2; }
        .mobile-control:nth-child(1) { grid-column: 2; grid-row: 3; }

        /* Sidebar */
        .sidebar {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .sidebar-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .sidebar-content ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .sidebar-content li {
            margin: 0.5rem 0;
        }

        /* Game Over Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .modal-stats {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
        }

        .stat-row .label {
            color: var(--text-secondary);
        }

        .stat-row .value {
            color: var(--accent-color);
            font-weight: 600;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .game-container {
                flex-direction: column;
            }
            
            .sidebar {
                min-width: auto;
            }
        }

        @media (max-width: 768px) {
            .game-title {
                font-size: 1.5rem;
            }

            .nav-buttons {
                gap: 0.5rem;
            }

            .nav-button {
                padding: 8px 16px;
                font-size: 0.8rem;
            }

            .game-container {
                padding: 1rem;
            }

            .mobile-controls {
                display: flex;
            }

            .stats-section {
                justify-content: center;
            }

            .game-controls {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                padding: 1rem;
            }

            .game-container {
                padding: 0.5rem;
            }

            .stat-box {
                padding: 0.5rem;
                min-width: 70px;
            }

            .control-button {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Top Ad Container -->
    <div class="ad-container-top">
        <div class="ad-placeholder">728x90 Header Advertisement</div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1 class="game-title">üèóÔ∏è Dig Dug Adventure</h1>
            <nav class="nav-buttons">
                <a href="/" class="nav-button">üè† Home</a>
                <a href="/games" class="nav-button">üéÆ More Games</a>
                <a href="#" class="nav-button" onclick="showInstructions()">‚ùì How to Play</a>
                <a href="#" class="nav-button" onclick="toggleFullscreen()">üì± Fullscreen</a>
            </nav>
        </div>
    </header>

    <!-- Main Game Container -->
    <div class="game-container">
        <!-- Game Section -->
        <main class="game-section">
            <div class="game-header">
                <div class="stats-section">
                    <div class="stat-box">
                        <div class="stat-label">Score</div>
                        <div class="stat-value" id="currentScore">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Best</div>
                        <div class="stat-value" id="bestScore">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Level</div>
                        <div class="stat-value" id="gameLevel">1</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Lives</div>
                        <div class="stat-value" id="gameLives">3</div>
                    </div>
                </div>
                
                <div class="game-controls">
                    <button class="control-button new-game" onclick="newGame()">üÜï New Game</button>
                    <button class="control-button pause" onclick="togglePause()" id="pauseButton">‚è∏Ô∏è Pause</button>
                    <button class="control-button" onclick="showLeaderboard()">üèÜ Scores</button>
                </div>
            </div>

            <!-- Game Canvas -->
            <div class="game-canvas-container">
                <canvas id="gameCanvas" width="600" height="400"></canvas>
            </div>

            <!-- Mobile Controls -->
            <div class="mobile-controls">
                <div class="mobile-control-grid">
                    <div class="mobile-control" onclick="moveDown()">‚¨áÔ∏è</div>
                    <div class="mobile-control" onclick="moveUp()">‚¨ÜÔ∏è</div>
                    <div class="mobile-control" onclick="moveLeft()">‚¨ÖÔ∏è</div>
                    <div class="mobile-control" onclick="moveRight()">‚û°Ô∏è</div>
                    <div class="mobile-control empty"></div>
                </div>
            </div>
        </main>

        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Instructions -->
            <div class="sidebar-section">
                <h3 class="sidebar-title">üéÆ How to Play</h3>
                <div class="sidebar-content">
                    <p><strong>Dig deep and find treasures!</strong></p>
                    <ul>
                        <li>Use arrow keys or WASD to move</li>
                        <li>Dig through dirt to create tunnels</li>
                        <li>Collect treasures for points</li>
                        <li>Avoid underground enemies</li>
                        <li>Complete levels by collecting all treasures</li>
                    </ul>
                    <p><strong>Enemy Types:</strong></p>
                    <ul>
                        <li>üî¥ Chasers - Follow your movement</li>
                        <li>üîµ Patrol - Move in set patterns</li>
                    </ul>
                </div>
            </div>

            <!-- Treasures Guide -->
            <div class="sidebar-section">
                <h3 class="sidebar-title">üíé Treasures</h3>
                <div class="sidebar-content">
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>üíö Gem</span>
                            <span style="color: var(--accent-color); font-weight: bold;">100 pts</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>üü° Gold</span>
                            <span style="color: var(--accent-color); font-weight: bold;">150 pts</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>üíé Diamond</span>
                            <span style="color: var(--accent-color); font-weight: bold;">200 pts</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>üåü Power-up</span>
                            <span style="color: var(--accent-color); font-weight: bold;">50 pts</span>
                        </div>
                    </div>
                    <p style="margin-top: 1rem;"><strong>Bonus:</strong> Complete levels for +500 points!</p>
                </div>
            </div>

            <!-- Tips -->
            <div class="sidebar-section">
                <h3 class="sidebar-title">üí° Pro Tips</h3>
                <div class="sidebar-content">
                    <ul>
                        <li>Plan your tunnel routes carefully</li>
                        <li>Corner enemies in dead ends</li>
                        <li>Collect power-ups for speed boosts</li>
                        <li>Watch enemy movement patterns</li>
                        <li>Create escape routes before exploring</li>
                    </ul>
                </div>
            </div>
        </aside>
    </div>

    <!-- Game Over Modal -->
    <div class="modal-overlay" id="gameOverModal">
        <div class="modal">
            <h2 class="modal-title" id="modalTitle">Game Over!</h2>
            <div class="modal-stats">
                <div class="stat-row">
                    <span class="label">Final Score:</span>
                    <span class="value" id="finalScore">0</span>
                </div>
                <div class="stat-row">
                    <span class="label">Level Reached:</span>
                    <span class="value" id="finalLevel">1</span>
                </div>
                <div class="stat-row">
                    <span class="label">Treasures Found:</span>
                    <span class="value" id="finalTreasures">0</span>
                </div>
                <div class="stat-row">
                    <span class="label">High Score:</span>
                    <span class="value" id="highScore">0</span>
                </div>
            </div>
            <div class="game-controls" style="justify-content: center; margin-top: 1rem;">
                <button class="control-button new-game" onclick="playAgain()">üîÑ Play Again</button>
                <button class="control-button pause" onclick="closeModal()">‚ùå Close</button>
            </div>
        </div>
    </div>

    <!-- Bottom Ad Container -->
    <div class="ad-container-bottom">
        <div class="ad-placeholder">728x90 Footer Advertisement</div>
    </div>

    <script>
        // Game State
        const game = {
            canvas: null,
            ctx: null,
            gameRunning: false,
            gamePaused: false,
            gameOver: false,
            score: 0,
            level: 1,
            lives: 3,
            treasures: 0,
            highScore: 0,
            gridSize: 20,
            player: {
                x: 0,
                y: 0,
                direction: 'right'
            },
            enemies: [],
            treasureItems: [],
            grid: [],
            powerUps: [],
            gameSpeed: 150,
            lastMoveTime: 0
        };

        // Game Analytics
        function trackEvent(eventName, parameters = {}) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    game_name: 'dig_dug_adventure',
                    ...parameters
                });
            }
        }

        // Initialize Game
        function initGame() {
            game.canvas = document.getElementById('gameCanvas');
            game.ctx = game.canvas.getContext('2d');
            
            // Load high score
            game.highScore = parseInt(localStorage.getItem('digDugHighScore') || '0');
            document.getElementById('bestScore').textContent = game.highScore;

            setupEventListeners();
            setupTouchControls();
            resizeCanvas();
            initGrid();
            
            // Initial draw
            drawGame();
            
            window.addEventListener('resize', resizeCanvas);
            trackEvent('game_loaded');
        }

        // Setup Event Listeners
        function setupEventListeners() {
            document.addEventListener('keydown', handleKeyPress);
        }

        // Resize Canvas
        function resizeCanvas() {
            const container = document.querySelector('.game-canvas-container');
            const maxWidth = Math.min(container.clientWidth - 32, 600);
            const ratio = 600 / 400;
            
            game.canvas.style.width = maxWidth + 'px';
            game.canvas.style.height = (maxWidth / ratio) + 'px';
        }

        // Initialize Grid
        function initGrid() {
            const cols = Math.floor(game.canvas.width / game.gridSize);
            const rows = Math.floor(game.canvas.height / game.gridSize);
            
            game.grid = [];
            for (let y = 0; y < rows; y++) {
                game.grid[y] = [];
                for (let x = 0; x < cols; x++) {
                    // Create dirt everywhere except top row (surface)
                    game.grid[y][x] = y === 0 ? 'empty' : 'dirt';
                }
            }
            
            // Create some pre-dug areas
            createInitialTunnels();
        }

        // Create Initial Tunnels
        function createInitialTunnels() {
            const cols = Math.floor(game.canvas.width / game.gridSize);
            const rows = Math.floor(game.canvas.height / game.gridSize);
            
            // Create horizontal tunnels
            for (let y = 2; y < rows; y += 3) {
                for (let x = 2; x < cols - 2; x++) {
                    if (Math.random() < 0.7) {
                        game.grid[y][x] = 'empty';
                    }
                }
            }
        }

        // New Game
        function newGame() {
            resetGameState();
            initializeLevel();
            
            game.gameRunning = true;
            game.gameOver = false;
            game.gamePaused = false;
            
            updateUI();
            gameLoop();
            trackEvent('game_started', { level: game.level });
        }

        // Reset Game State
        function resetGameState() {
            game.score = 0;
            game.level = 1;
            game.lives = 3;
            game.treasures = 0;
            game.enemies = [];
            game.treasureItems = [];
            game.powerUps = [];
        }

        // Initialize Level
        function initializeLevel() {
            const cols = Math.floor(game.canvas.width / game.gridSize);
            const rows = Math.floor(game.canvas.height / game.gridSize);
            
            // Reset player position
            game.player.x = 0;
            game.player.y = 0;
            
            // Clear starting area
            game.grid[0][0] = 'empty';
            game.grid[0][1] = 'empty';
            
            // Generate enemies, treasures, and power-ups
            generateEnemies();
            generateTreasures();
            generatePowerUps();
        }

        // Generate Enemies
        function generateEnemies() {
            const cols = Math.floor(game.canvas.width / game.gridSize);
            const rows = Math.floor(game.canvas.height / game.gridSize);
            const enemyCount = Math.min(3 + game.level, 8);
            
            for (let i = 0; i < enemyCount; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * cols);
                    y = Math.floor(Math.random() * (rows - 5)) + 3;
                } while (game.grid[y][x] !== 'empty' || (x < 3 && y < 3));
                
                game.enemies.push({
                    x: x,
                    y: y,
                    type: Math.random() < 0.5 ? 'chaser' : 'patrol',
                    direction: ['up', 'down', 'left', 'right'][Math.floor(Math.random() * 4)],
                    lastMoveTime: 0,
                    speed: 200 + Math.random() * 100
                });
            }
        }

        // Generate Treasures
        function generateTreasures() {
            const cols = Math.floor(game.canvas.width / game.gridSize);
            const rows = Math.floor(game.canvas.height / game.gridSize);
            const treasureCount = 5 + Math.floor(game.level / 2);
            
            for (let i = 0; i < treasureCount; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * cols);
                    y = Math.floor(Math.random() * (rows - 2)) + 2;
                } while ((x < 3 && y < 3) || game.treasureItems.some(t => t.x === x && t.y === y));
                
                const treasureTypes = ['gem', 'gold', 'diamond'];
                const type = treasureTypes[Math.floor(Math.random() * treasureTypes.length)];
                
                game.treasureItems.push({
                    x: x,
                    y: y,
                    type: type,
                    value: type === 'diamond' ? 200 : type === 'gold' ? 150 : 100,
                    collected: false
                });
            }
        }

        // Generate Power-ups
        function generatePowerUps() {
            if (game.level % 3 === 0) {
                const cols = Math.floor(game.canvas.width / game.gridSize);
                const rows = Math.floor(game.canvas.height / game.gridSize);
                
                let x, y;
                do {
                    x = Math.floor(Math.random() * cols);
                    y = Math.floor(Math.random() * (rows - 2)) + 2;
                } while (x < 3 && y < 3);
                
                game.powerUps.push({
                    x: x,
                    y: y,
                    type: 'speed',
                    duration: 5000,
                    collected: false
                });
            }
        }

        // Game Loop
        function gameLoop() {
            if (!game.gameRunning || game.gameOver) return;
            
            if (!game.gamePaused) {
                const currentTime = Date.now();
                
                // Move enemies
                moveEnemies(currentTime);
                
                // Check collisions
                checkCollisions();
                
                // Check level completion
                checkLevelCompletion();
            }
            
            drawGame();
            requestAnimationFrame(gameLoop);
        }

        // Move Enemies
        function moveEnemies(currentTime) {
            game.enemies.forEach(enemy => {
                if (currentTime - enemy.lastMoveTime > enemy.speed) {
                    if (enemy.type === 'chaser') {
                        moveEnemyTowardsPlayer(enemy);
                    } else {
                        moveEnemyPatrol(enemy);
                    }
                    enemy.lastMoveTime = currentTime;
                }
            });
        }

       // Move Enemy Towards Player (continued)
       function moveEnemyTowardsPlayer(enemy) {
           const cols = Math.floor(game.canvas.width / game.gridSize);
           const rows = Math.floor(game.canvas.height / game.gridSize);
           
           let newX = enemy.x;
           let newY = enemy.y;
           
           if (Math.abs(game.player.x - enemy.x) > Math.abs(game.player.y - enemy.y)) {
               newX = enemy.x + (game.player.x > enemy.x ? 1 : -1);
           } else {
               newY = enemy.y + (game.player.y > enemy.y ? 1 : -1);
           }
           
           // Check bounds and if path is clear
           if (newX >= 0 && newX < cols && newY >= 0 && newY < rows && 
               game.grid[newY][newX] === 'empty') {
               enemy.x = newX;
               enemy.y = newY;
           }
       }

       // Move Enemy Patrol
       function moveEnemyPatrol(enemy) {
           const cols = Math.floor(game.canvas.width / game.gridSize);
           const rows = Math.floor(game.canvas.height / game.gridSize);
           
           let newX = enemy.x;
           let newY = enemy.y;
           
           switch (enemy.direction) {
               case 'up': newY--; break;
               case 'down': newY++; break;
               case 'left': newX--; break;
               case 'right': newX++; break;
           }
           
           // Check if can move in current direction
           if (newX < 0 || newX >= cols || newY < 0 || newY >= rows || 
               game.grid[newY][newX] !== 'empty') {
               // Change direction randomly
               const directions = ['up', 'down', 'left', 'right'];
               enemy.direction = directions[Math.floor(Math.random() * directions.length)];
           } else {
               enemy.x = newX;
               enemy.y = newY;
           }
       }

       // Check Collisions
       function checkCollisions() {
           // Check enemy collisions
           game.enemies.forEach(enemy => {
               if (enemy.x === game.player.x && enemy.y === game.player.y) {
                   loseLife();
               }
           });
           
           // Check treasure collection
           game.treasureItems.forEach(treasure => {
               if (!treasure.collected && treasure.x === game.player.x && treasure.y === game.player.y) {
                   collectTreasure(treasure);
               }
           });
           
           // Check power-up collection
           game.powerUps.forEach(powerUp => {
               if (!powerUp.collected && powerUp.x === game.player.x && powerUp.y === game.player.y) {
                   collectPowerUp(powerUp);
               }
           });
       }

       // Collect Treasure
       function collectTreasure(treasure) {
           treasure.collected = true;
           game.score += treasure.value;
           game.treasures++;
           updateUI();
           trackEvent('treasure_collected', { type: treasure.type, value: treasure.value });
       }

       // Collect Power-up
       function collectPowerUp(powerUp) {
           powerUp.collected = true;
           game.score += 50;
           updateUI();
           trackEvent('powerup_collected', { type: powerUp.type });
       }

       // Lose Life
       function loseLife() {
           game.lives--;
           updateUI();
           
           if (game.lives <= 0) {
               endGame();
           } else {
               // Reset player position
               game.player.x = 0;
               game.player.y = 0;
               trackEvent('life_lost', { lives_remaining: game.lives });
           }
       }

       // Check Level Completion
       function checkLevelCompletion() {
           const collectedTreasures = game.treasureItems.filter(t => t.collected).length;
           const totalTreasures = game.treasureItems.length;
           
           if (collectedTreasures === totalTreasures) {
               completeLevel();
           }
       }

       // Complete Level
       function completeLevel() {
           game.level++;
           game.score += 500; // Level completion bonus
           
           // Regenerate level
           initGrid();
           initializeLevel();
           
           updateUI();
           trackEvent('level_completed', { level: game.level - 1, score: game.score });
       }

       // End Game
       function endGame() {
           game.gameRunning = false;
           game.gameOver = true;
           
           // Update high score
           if (game.score > game.highScore) {
               game.highScore = game.score;
               localStorage.setItem('digDugHighScore', game.highScore.toString());
           }
           
           showGameOverModal();
           trackEvent('game_over', { 
               final_score: game.score, 
               level_reached: game.level,
               treasures_collected: game.treasures
           });
       }

       // Show Game Over Modal
       function showGameOverModal() {
           document.getElementById('finalScore').textContent = game.score;
           document.getElementById('finalLevel').textContent = game.level;
           document.getElementById('finalTreasures').textContent = game.treasures;
           document.getElementById('highScore').textContent = game.highScore;
           
           const modal = document.getElementById('gameOverModal');
           const title = document.getElementById('modalTitle');
           
           if (game.score === game.highScore && game.score > 0) {
               title.textContent = 'üèÜ New High Score!';
           } else if (game.level >= 5) {
               title.textContent = 'üéØ Great Adventure!';
           } else {
               title.textContent = 'üíÄ Game Over!';
           }
           
           modal.style.display = 'flex';
       }

       // Close Modal
       function closeModal() {
           document.getElementById('gameOverModal').style.display = 'none';
       }

       // Play Again
       function playAgain() {
           closeModal();
           newGame();
       }

       // Draw Game
       function drawGame() {
           const ctx = game.ctx;
           const canvas = game.canvas;
           
           // Clear canvas
           ctx.fillStyle = '#2F4F2F';
           ctx.fillRect(0, 0, canvas.width, canvas.height);
           
           // Draw grid
           drawGrid();
           
           // Draw treasures (behind everything)
           drawTreasures();
           
           // Draw power-ups
           drawPowerUps();
           
           // Draw enemies
           drawEnemies();
           
           // Draw player
           drawPlayer();
           
           // Draw game state overlays
           if (game.gamePaused) {
               drawPauseOverlay();
           }
           
           if (!game.gameRunning && !game.gameOver) {
               drawStartScreen();
           }
       }

       // Draw Grid
       function drawGrid() {
           const ctx = game.ctx;
           const rows = game.grid.length;
           const cols = game.grid[0].length;
           
           for (let y = 0; y < rows; y++) {
               for (let x = 0; x < cols; x++) {
                   const cellX = x * game.gridSize;
                   const cellY = y * game.gridSize;
                   
                   if (game.grid[y][x] === 'dirt') {
                       // Draw dirt
                       ctx.fillStyle = '#8B4513';
                       ctx.fillRect(cellX, cellY, game.gridSize, game.gridSize);
                       
                       // Add texture
                       ctx.fillStyle = '#A0522D';
                       ctx.fillRect(cellX + 2, cellY + 2, game.gridSize - 4, game.gridSize - 4);
                       
                       // Add spots
                       ctx.fillStyle = '#654321';
                       for (let i = 0; i < 3; i++) {
                           const spotX = cellX + Math.random() * (game.gridSize - 4) + 2;
                           const spotY = cellY + Math.random() * (game.gridSize - 4) + 2;
                           ctx.fillRect(spotX, spotY, 2, 2);
                       }
                   } else {
                       // Draw empty space (tunnel)
                       ctx.fillStyle = '#1a1a1a';
                       ctx.fillRect(cellX, cellY, game.gridSize, game.gridSize);
                       
                       // Add tunnel border
                       ctx.strokeStyle = '#333';
                       ctx.lineWidth = 1;
                       ctx.strokeRect(cellX, cellY, game.gridSize, game.gridSize);
                   }
               }
           }
       }

       // Draw Player
       function drawPlayer() {
           const ctx = game.ctx;
           const x = game.player.x * game.gridSize;
           const y = game.player.y * game.gridSize;
           const size = game.gridSize;
           
           // Dig current position
           if (game.gameRunning && game.grid[game.player.y] && game.grid[game.player.y][game.player.x] === 'dirt') {
               game.grid[game.player.y][game.player.x] = 'empty';
           }
           
           // Draw player body
           ctx.fillStyle = '#FFD700';
           ctx.fillRect(x + 2, y + 2, size - 4, size - 4);
           
           // Draw player helmet
           ctx.fillStyle = '#FFA500';
           ctx.fillRect(x + 4, y + 1, size - 8, 6);
           
           // Draw direction indicator
           ctx.fillStyle = '#FF6347';
           switch (game.player.direction) {
               case 'up':
                   ctx.fillRect(x + size/2 - 2, y + 1, 4, 4);
                   break;
               case 'down':
                   ctx.fillRect(x + size/2 - 2, y + size - 5, 4, 4);
                   break;
               case 'left':
                   ctx.fillRect(x + 1, y + size/2 - 2, 4, 4);
                   break;
               case 'right':
                   ctx.fillRect(x + size - 5, y + size/2 - 2, 4, 4);
                   break;
           }
           
           // Draw drill (weapon)
           ctx.fillStyle = '#C0C0C0';
           ctx.fillRect(x + size/2 - 1, y + size/2 - 1, 2, 2);
       }

       // Draw Enemies
       function drawEnemies() {
           const ctx = game.ctx;
           
           game.enemies.forEach(enemy => {
               const x = enemy.x * game.gridSize;
               const y = enemy.y * game.gridSize;
               const size = game.gridSize;
               
               if (enemy.type === 'chaser') {
                   // Draw chaser enemy (red)
                   ctx.fillStyle = '#FF4444';
                   ctx.fillRect(x + 1, y + 1, size - 2, size - 2);
                   
                   // Eyes
                   ctx.fillStyle = '#FFFFFF';
                   ctx.fillRect(x + 4, y + 4, 3, 3);
                   ctx.fillRect(x + size - 7, y + 4, 3, 3);
                   
                   // Pupils
                   ctx.fillStyle = '#000000';
                   ctx.fillRect(x + 5, y + 5, 1, 1);
                   ctx.fillRect(x + size - 6, y + 5, 1, 1);
               } else {
                   // Draw patrol enemy (blue)
                   ctx.fillStyle = '#4444FF';
                   ctx.fillRect(x + 1, y + 1, size - 2, size - 2);
                   
                   // Pattern
                   ctx.fillStyle = '#6666FF';
                   ctx.fillRect(x + 3, y + 3, size - 6, size - 6);
                   
                   // Direction indicator
                   ctx.fillStyle = '#FFFFFF';
                   switch (enemy.direction) {
                       case 'up':
                           ctx.fillRect(x + size/2 - 1, y + 2, 2, 4);
                           break;
                       case 'down':
                           ctx.fillRect(x + size/2 - 1, y + size - 6, 2, 4);
                           break;
                       case 'left':
                           ctx.fillRect(x + 2, y + size/2 - 1, 4, 2);
                           break;
                       case 'right':
                           ctx.fillRect(x + size - 6, y + size/2 - 1, 4, 2);
                           break;
                   }
               }
           });
       }

       // Draw Treasures
       function drawTreasures() {
           const ctx = game.ctx;
           
           game.treasureItems.forEach(treasure => {
               if (treasure.collected) return;
               
               const x = treasure.x * game.gridSize;
               const y = treasure.y * game.gridSize;
               const size = game.gridSize;
               
               // Add sparkle effect
               const time = Date.now() * 0.005;
               const sparkle = Math.sin(time + treasure.x + treasure.y) * 0.3 + 0.7;
               
               switch (treasure.type) {
                   case 'gem':
                       ctx.fillStyle = `rgba(0, 255, 128, ${sparkle})`;
                       ctx.fillRect(x + 4, y + 4, size - 8, size - 8);
                       ctx.fillStyle = '#00FF80';
                       ctx.fillRect(x + 6, y + 6, size - 12, size - 12);
                       break;
                   case 'gold':
                       ctx.fillStyle = `rgba(255, 215, 0, ${sparkle})`;
                       ctx.fillRect(x + 3, y + 3, size - 6, size - 6);
                       ctx.fillStyle = '#FFD700';
                       ctx.fillRect(x + 5, y + 5, size - 10, size - 10);
                       break;
                   case 'diamond':
                       ctx.fillStyle = `rgba(185, 242, 255, ${sparkle})`;
                       ctx.fillRect(x + 2, y + 4, size - 4, size - 8);
                       ctx.fillRect(x + 4, y + 2, size - 8, size - 4);
                       ctx.fillStyle = '#B9F2FF';
                       ctx.fillRect(x + 4, y + 4, size - 8, size - 8);
                       break;
               }
           });
       }

       // Draw Power-ups
       function drawPowerUps() {
           const ctx = game.ctx;
           
           game.powerUps.forEach(powerUp => {
               if (powerUp.collected) return;
               
               const x = powerUp.x * game.gridSize;
               const y = powerUp.y * game.gridSize;
               const size = game.gridSize;
               
               // Pulsing effect
               const time = Date.now() * 0.01;
               const pulse = Math.sin(time) * 0.2 + 0.8;
               
               ctx.fillStyle = `rgba(255, 0, 255, ${pulse})`;
               ctx.fillRect(x + 2, y + 2, size - 4, size - 4);
               
               ctx.fillStyle = '#FF00FF';
               ctx.fillRect(x + 4, y + 4, size - 8, size - 8);
               
               // Power symbol
               ctx.fillStyle = '#FFFFFF';
               ctx.fillRect(x + size/2 - 1, y + 6, 2, 8);
               ctx.fillRect(x + 6, y + size/2 - 1, 8, 2);
           });
       }

       // Draw Start Screen
       function drawStartScreen() {
           const ctx = game.ctx;
           
           ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
           ctx.fillRect(0, 0, game.canvas.width, game.canvas.height);
           
           ctx.fillStyle = '#06d6a0';
           ctx.font = "24px Orbitron";
           ctx.textAlign = "center";
           ctx.fillText("Click New Game to Begin!", game.canvas.width / 2, game.canvas.height / 2);
           
           ctx.font = "16px Inter";
           ctx.fillText("Dig tunnels and collect treasures!", game.canvas.width / 2, game.canvas.height / 2 + 40);
       }

       // Draw Pause Overlay
       function drawPauseOverlay() {
           const ctx = game.ctx;
           
           ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
           ctx.fillRect(0, 0, game.canvas.width, game.canvas.height);
           
           ctx.fillStyle = '#06d6a0';
           ctx.font = "24px Orbitron";
           ctx.textAlign = "center";
           ctx.fillText("PAUSED", game.canvas.width / 2, game.canvas.height / 2);
           
           ctx.font = "16px Inter";
           ctx.fillText("Press Space or Pause button to continue", game.canvas.width / 2, game.canvas.height / 2 + 40);
       }

       // Handle Key Press
       function handleKeyPress(e) {
           if (game.gameOver) return;
           
           const keyMap = {
               "ArrowUp": "up",
               "ArrowDown": "down", 
               "ArrowLeft": "left",
               "ArrowRight": "right",
               "KeyW": "up",
               "KeyS": "down",
               "KeyA": "left",
               "KeyD": "right"
           };
           
           if (keyMap[e.code]) {
               e.preventDefault();
               handleMove(keyMap[e.code]);
           } else if (e.code === "Space") {
               e.preventDefault();
               if (game.gameRunning) {
                   togglePause();
               } else {
                   newGame();
               }
           } else if (e.code === "KeyN") {
               e.preventDefault();
               newGame();
           }
       }

       // Handle Movement
       function handleMove(direction) {
           if (!game.gameRunning || game.gamePaused) return;
           
           const currentTime = Date.now();
           if (currentTime - game.lastMoveTime < game.gameSpeed) return;
           
           const cols = Math.floor(game.canvas.width / game.gridSize);
           const rows = Math.floor(game.canvas.height / game.gridSize);
           
           let newX = game.player.x;
           let newY = game.player.y;
           
           switch (direction) {
               case 'up':
                   newY = Math.max(0, game.player.y - 1);
                   break;
               case 'down':
                   newY = Math.min(rows - 1, game.player.y + 1);
                   break;
               case 'left':
                   newX = Math.max(0, game.player.x - 1);
                   break;
               case 'right':
                   newX = Math.min(cols - 1, game.player.x + 1);
                   break;
           }
           
           // Update player position
           game.player.x = newX;
           game.player.y = newY;
           game.player.direction = direction;
           game.lastMoveTime = currentTime;
           
           trackEvent("move_made", { direction: direction });
       }

       // Mobile Control Functions
       function moveUp() { handleMove("up"); }
       function moveDown() { handleMove("down"); }
       function moveLeft() { handleMove("left"); }
       function moveRight() { handleMove("right"); }

       // Setup Touch Controls
       function setupTouchControls() {
           let startX, startY;
           
           game.canvas.addEventListener("touchstart", (e) => {
               startX = e.touches[0].clientX;
               startY = e.touches[0].clientY;
               e.preventDefault();
           });
           
           game.canvas.addEventListener("touchend", (e) => {
               if (!startX || !startY) return;
               
               const endX = e.changedTouches[0].clientX;
               const endY = e.changedTouches[0].clientY;
               
               const deltaX = endX - startX;
               const deltaY = endY - startY;
               
               const minSwipeDistance = 30;
               
               if (Math.abs(deltaX) > Math.abs(deltaY)) {
                   if (Math.abs(deltaX) > minSwipeDistance) {
                       handleMove(deltaX > 0 ? "right" : "left");
                   }
               } else {
                   if (Math.abs(deltaY) > minSwipeDistance) {
                       handleMove(deltaY > 0 ? "down" : "up");
                   }
               }
               
               startX = null;
               startY = null;
               e.preventDefault();
           });
       }

       // Toggle Pause
       function togglePause() {
           if (!game.gameRunning) return;
           
           game.gamePaused = !game.gamePaused;
           document.getElementById('pauseButton').textContent = game.gamePaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
           
           trackEvent(game.gamePaused ? 'game_paused' : 'game_resumed');
       }

       // Update UI
       function updateUI() {
           document.getElementById('currentScore').textContent = game.score;
           document.getElementById('gameLevel').textContent = game.level;
           document.getElementById('gameLives').textContent = game.lives;
           document.getElementById('bestScore').textContent = game.highScore;
       }

       // Show Instructions
       function showInstructions() {
           alert('üéÆ How to Play Dig Dug Adventure:\n\n' +
                 '‚Ä¢ Use arrow keys or WASD to move\n' +
                 '‚Ä¢ Dig through dirt to create tunnels\n' +
                 '‚Ä¢ Collect treasures for points\n' +
                 '‚Ä¢ Avoid red chasers and blue patrol enemies\n' +
                 '‚Ä¢ Complete levels by collecting all treasures\n\n' +
                 'Scoring:\n' +
                 'üíö Gem: 100 points\n' +
                 'üü° Gold: 150 points\n' +
                 'üíé Diamond: 200 points\n' +
                 'üåü Power-up: 50 points\n' +
                 'üèÜ Level Complete: 500 bonus points');
       }

       // Show Leaderboard
       function showLeaderboard() {
           const scores = JSON.parse(localStorage.getItem('digDugScores') || '[]');
           let leaderboard = 'Top 5 Scores:\n\n';
           
           if (scores.length === 0) {
               leaderboard += 'No scores yet. Be the first!';
           } else {
               scores.slice(0, 5).forEach((score, index) => {
                   leaderboard += `${index + 1}. ${score.toLocaleString()} points\n`;
               });
           }
           
           alert(leaderboard);
       }

       // Toggle Fullscreen
       function toggleFullscreen() {
           if (!document.fullscreenElement) {
               document.documentElement.requestFullscreen();
           } else {
               if (document.exitFullscreen) {
                   document.exitFullscreen();
               }
           }
       }

       // Initialize when page loads
       window.addEventListener('load', initGame);
   </script>
</body>
</html>