<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missile Command - Free HTML5 Game | GamesZone99</title>
    <meta name="description" content="Play Missile Command for free! Classic arcade defense game where you protect cities from incoming missiles. Mobile-friendly browser game with no download required.">
    <meta name="keywords" content="missile command, arcade game, html5 game, free online game, browser game, mobile game, defense game">
    <meta name="author" content="GamesZone99">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="game">
    <meta property="og:url" content="https://gameszone99.com/missile-command.html">
    <meta property="og:title" content="Missile Command - Free HTML5 Game">
    <meta property="og:description" content="Classic arcade defense game - protect your cities from incoming missiles!">
    <meta property="og:image" content="https://gameszone99.com/assets/missile-command-og.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://gameszone99.com/missile-command.html">
    <meta property="twitter:title" content="Missile Command - Free HTML5 Game">
    <meta property="twitter:description" content="Classic arcade defense game - protect your cities from incoming missiles!">
    
    <link rel="canonical" href="https://gameszone99.com/missile-command.html">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --dark-gradient: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 100%);
    --accent-color: #00d4ff;
    --success-color: #00ff88;
    --warning-color: #ffaa00;
    --text-primary: #ffffff;
    --text-secondary: #b8c1ec;
    --card-bg: rgba(255, 255, 255, 0.05);
    --card-border: rgba(255, 255, 255, 0.1);
    --shadow-glow: 0 0 40px rgba(0, 212, 255, 0.3);
    --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.3);
}

body {
    font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--dark-gradient);
    min-height: 100vh;
    color: var(--text-primary);
}

        /* Ad Containers */
        .ad-container-top, .ad-container-bottom {
    width: 100%;
    min-height: 90px;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    border-bottom: 1px solid var(--card-border);
    position: sticky;
    top: 0;
    z-index: 100;
}

.ad-container-bottom {
    border-top: 1px solid var(--card-border);
    border-bottom: none;
    margin-top: 2rem;
    position: static;
}

.header {
    padding: 1rem 0;
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--card-border);
}
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .game-title {
            font-family: "Orbitron", monospace;
            font-size: 1.8rem;
            font-weight: 900;
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-button {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .nav-button:hover {
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-card);
        }

        /* Main Layout */
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
        }

        .game-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-card);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .game-section.loading {
            opacity: 1;
            transform: translateY(0);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.6s ease 0.2s;
        }

        .sidebar.loading {
            opacity: 1;
            transform: translateX(0);
        }

        .sidebar-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-card);
        }

        .sidebar-title {
            font-family: "Orbitron", monospace;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .instructions {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .instructions ul {
            margin-top: 0.5rem;
            padding-left: 1.2rem;
        }

        .instructions li {
            margin-bottom: 0.3rem;
        }

        /* Game Header */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .stats-section {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .stat-box {
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.8rem 1rem;
            border-radius: 10px;
            border: 1px solid var(--card-border);
            min-width: 80px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.3rem;
        }

        .stat-value {
            font-family: "Orbitron", monospace;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .game-controls {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
        }

        .control-button {
            padding: 8px 16px;
            background: var(--secondary-gradient);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-card);
        }

        .control-button.new-game {
            background: var(--success-color);
        }

        .control-button.pause {
            background: var(--warning-color);
        }

        /* Game Canvas */
        .game-canvas-container {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 15px;
            padding: 1rem;
            backdrop-filter: blur(10px);
            position: relative;
            text-align: center;
        }

        #gameCanvas {
            background: linear-gradient(180deg, #0a0a0a 0%, #1a1a2e 50%, #2a2a4e 100%);
            border: 2px solid var(--card-border);
            border-radius: 10px;
            display: block;
            margin: 0 auto;
            max-width: 100%;
            cursor: crosshair;
        }

        .start-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            pointer-events: none;
        }

        .start-button {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 15px;
            cursor: pointer;
            margin-top: 1rem;
            pointer-events: all;
            transition: all 0.3s ease;
        }

        .start-button:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-card);
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
            max-width: 250px;
            margin-left: auto;
            margin-right: auto;
        }

        .mobile-control {
            aspect-ratio: 1;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            user-select: none;
        }

        .mobile-control:hover {
            transform: scale(1.05);
            background: var(--card-border);
        }

        .mobile-control.empty {
            visibility: hidden;
        }

        /* Game Over Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-card);
            max-width: 400px;
            width: 90%;
        }

        .modal-title {
            font-family: "Orbitron", monospace;
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .modal-stats {
            margin: 1.5rem 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .modal-stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 10px;
            border: 1px solid var(--card-border);
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .modal-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-card);
        }

        .modal-button.primary {
            background: var(--accent-color);
            color: #000;
        }

        .modal-button.secondary {
            background: var(--secondary-gradient);
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .game-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }

            .mobile-controls {
                display: grid;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .game-title {
                font-size: 1.5rem;
            }

            .nav-buttons {
                justify-content: center;
            }

            .game-header {
                flex-direction: column;
                align-items: stretch;
            }

            .stats-section {
                justify-content: center;
            }

            .control-button {
                flex: 1;
                min-width: 100px;
            }

            #gameCanvas {
                width: 100%;
                height: auto;
            }

            .ad-placeholder {
                font-size: 12px;
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .game-section, .sidebar-section {
                padding: 1rem;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .modal-stats {
                grid-template-columns: 1fr;
            }

            .ad-placeholder {
                font-size: 11px;
            }
        }

        /* Animations */
        .pulse {
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .explosion {
            animation: explosion 0.5s ease-out;
        }

        @keyframes explosion {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Top Ad Container -->
    <div class="ad-container-top">
        <div class="ad-placeholder">728x90 Header Advertisement</div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1 class="game-title">🚀 Missile Command</h1>
            <nav class="nav-buttons">
                <a href="/" class="nav-button">🏠 Home</a>
                <a href="/games" class="nav-button">🎮 More Games</a>
                <a href="#" class="nav-button" onclick="showInstructions()">❓ How to Play</a>
                <a href="#" class="nav-button" onclick="toggleFullscreen()">📱 Fullscreen</a>
            </nav>
        </div>
    </header>

    <!-- Main Game Container -->
    <div class="game-container">
        <!-- Game Section -->
        <main class="game-section loading">
            <div class="game-header">
                <div class="stats-section">
                    <div class="stat-box">
                        <div class="stat-label">Score</div>
                        <div class="stat-value" id="currentScore">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Best</div>
                        <div class="stat-value" id="bestScore">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Level</div>
                        <div class="stat-value" id="currentLevel">1</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Cities</div>
                        <div class="stat-value" id="citiesLeft">6</div>
                    </div>
                </div>
                
                <div class="game-controls">
                    <button class="control-button new-game" onclick="startNewGame()">🆕 New Game</button>
                    <button class="control-button pause" onclick="togglePause()" id="pauseButton">⏸️ Pause</button>
                    <button class="control-button" onclick="showLeaderboard()">🏆 Scores</button>
                </div>
            </div>

            <!-- Game Canvas -->
            <div class="game-canvas-container">
                <canvas id="gameCanvas" width="600" height="400"></canvas>
                <div class="start-screen" id="startScreen">
                    <h2>🚀 Missile Command</h2>
                    <p>Protect your cities from incoming missiles!</p>
                    <button class="start-button" onclick="startGame()">▶️ Start Game</button>
                </div>
            </div>

            <!-- Mobile Controls -->
            <div class="mobile-controls">
                <div class="mobile-control" onclick="fireAtPosition('left')">🎯</div>
                <div class="mobile-control" onclick="fireAtPosition('center')">🎯</div>
                <div class="mobile-control" onclick="fireAtPosition('right')">🎯</div>
            </div>
        </main>

        <!-- Sidebar -->
        <aside class="sidebar loading">
            <div class="sidebar-section">
                <h3 class="sidebar-title">🎯 How to Play</h3>
                <div class="instructions">
                    <p><strong>Defend your cities from incoming missiles!</strong></p>
                    <ul>
                        <li>Click or tap to fire defensive missiles</li>
                        <li>Destroy enemy missiles before they hit cities</li>
                        <li>Complete waves to advance levels</li>
                        <li>Don't let all cities be destroyed!</li>
                        <li>Earn bonus points for remaining cities</li>
                    </ul>
                </div>
            </div>

            <div class="sidebar-section" style="min-height: 250px; display: flex; align-items: center; justify-content: center;">
                <div style="width: 250px; height: 250px; background: linear-gradient(45deg, #333, #555); border: 2px dashed #666; display: flex; align-items: center; justify-content: center; color: #999; font-size: 14px; border-radius: 8px; text-align: center;">
                    250x250<br>Sidebar Ad
                </div>
            </div>
        </aside>
    </div>

    <!-- Game Over Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <div class="modal-title">🎮 Game Over</div>
            <div class="modal-stats">
                <div class="modal-stat">
                    <div class="stat-label">Final Score</div>
                    <div class="stat-value" id="finalScore">0</div>
                </div>
                <div class="modal-stat">
                    <div class="stat-label">Level Reached</div>
                    <div class="stat-value" id="finalLevel">1</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-button primary" onclick="startNewGame()">🔄 Play Again</button>
                <button class="modal-button secondary" onclick="shareScore()">📤 Share Score</button>
                <button class="modal-button secondary" onclick="closeModal()">❌ Close</button>
            </div>
        </div>
    </div>

    <!-- Bottom Ad Container -->
    <div class="ad-container-bottom">
        <div class="ad-placeholder">728x90 Footer Advertisement</div>
    </div>

    <script>
        // Game State
        const game = {
            canvas: null,
            ctx: null,
            score: 0,
            bestScore: parseInt(localStorage.getItem("missileCommandBest")) || 0,
            level: 1,
            cities: 6,
            gameRunning: false,
            gamePaused: false,
            gameStarted: false,
            missiles: [],
            explosions: [],
            defenseMissiles: [],
            crosshair: { x: 300, y: 200 },
            gameSpeed: 1,
            missileSpeed: 1,
            nextWaveCountdown: 0,
            particleSystem: []
        };

        // Initialize game
        function initGame() {
            game.canvas = document.getElementById("gameCanvas");
            game.ctx = game.canvas.getContext("2d");
            
            // Set canvas size
            resizeCanvas();
            
            // Load best score
            document.getElementById("bestScore").textContent = game.bestScore.toLocaleString();
            
            // Event listeners
            game.canvas.addEventListener("click", handleCanvasClick);
            game.canvas.addEventListener("touchstart", handleTouchStart, { passive: false });
            game.canvas.addEventListener("mousemove", handleMouseMove);
            document.addEventListener("keydown", handleKeyPress);
            window.addEventListener("resize", resizeCanvas);
            
            // Initial render
            render();
            
            // Animate UI elements
            setTimeout(() => {
                document.querySelectorAll(".loading").forEach(el => {
                    el.style.opacity = "1";
                    el.style.transform = el.classList.contains("sidebar") ? "translateX(0)" : "translateY(0)";
                });
            }, 100);

            console.log("🎮 Missile Command initialized!");
        }

        function resizeCanvas() {
            const container = game.canvas.parentElement;
            const maxWidth = Math.min(600, container.clientWidth - 32);
            game.canvas.style.width = maxWidth + "px";
            game.canvas.style.height = (maxWidth * 2/3) + "px";
        }

        function startGame() {
            document.getElementById("startScreen").style.display = "none";
            game.gameStarted = true;
            game.gameRunning = true;
            game.gamePaused = false;
            game.score = 0;
            game.level = 1;
            game.cities = 6;
            game.missiles = [];
            game.explosions = [];
            game.defenseMissiles = [];
            game.nextWaveCountdown = 0;
            
            updateDisplay();
            spawnWave();
            gameLoop();
            
            trackEvent("game_start");
        }

        function startNewGame() {
            closeModal();
            document.getElementById("startScreen").style.display = "flex";
            game.gameStarted = false;
            game.gameRunning = false;
            render();
        }

        function gameLoop() {
            if (!game.gameRunning) return;
            
            if (!game.gamePaused) {
                updateGame();
            }
            
            render();
            requestAnimationFrame(gameLoop);
        }

        function updateGame() {
            // Update missiles
            game.missiles = game.missiles.filter(missile => {
                missile.x += missile.vx * game.missileSpeed;
                missile.y += missile.vy * game.missileSpeed;
                
                // Check if missile hit ground
                if (missile.y >= 360) {
                    // Check if it hit a city
                    const cityIndex = Math.floor((missile.x - 50) / 85);
                    if (cityIndex >= 0 && cityIndex < 6 && missile.x >= 50 && missile.x <= 550) {
                        if (game.cities > 0) {
                            game.cities--;
                            createExplosion(missile.x, 360, "#ff4444", 30);
                            playSound("explosion");
                        }
                    }
                    return false;
                }
                
                return missile.y > 0 && missile.x >= 0 && missile.x <= 600;
            });

            // Update defense missiles
            game.defenseMissiles = game.defenseMissiles.filter(missile => {
                const dx = missile.targetX - missile.x;
                const dy = missile.targetY - missile.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist < 5) {
                    // Create explosion at target
                    createExplosion(missile.targetX, missile.targetY, "#00ff00", 40);
                    playSound("explosion");
                    return false;
                }
                
                missile.x += missile.vx * 4;
                missile.y += missile.vy * 4;
                
                return true;
            });

            // Update explosions
            game.explosions = game.explosions.filter(explosion => {
                explosion.size += explosion.growth;
                explosion.life--;
                
                if (explosion.life <= 0) {
                    return false;
                }
                
                // Check collision with missiles
                game.missiles = game.missiles.filter(missile => {
                    const dx = missile.x - explosion.x;
                    const dy = missile.y - explosion.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist < explosion.size) {
                        game.score += 25 * game.level;
                        createExplosion(missile.x, missile.y, "#ffff00", 20);
                        playSound("hit");
                        return false;
                    }
                    return true;
                });
                
                return true;
            });

            // Check if wave is complete
            if (game.missiles.length === 0 && game.nextWaveCountdown <= 0) {
                game.nextWaveCountdown = 60; // 1 second at 60fps
            }
            
            if (game.nextWaveCountdown > 0) {
                game.nextWaveCountdown--;
                if (game.nextWaveCountdown === 0) {
                    // Bonus points for surviving cities
                    game.score += game.cities * 100 * game.level;
                    game.level++;
                    game.missileSpeed += 0.2;
                    spawnWave();
                }
            }

            // Check game over
            if (game.cities <= 0) {
                endGame();
            }

            updateDisplay();
        }

        function spawnWave() {
            const numMissiles = Math.min(4 + game.level, 12);
            
            for (let i = 0; i < numMissiles; i++) {
                setTimeout(() => {
                    if (game.gameRunning) {
                        const startX = Math.random() * 600;
                        const targetX = 50 + Math.random() * 500;
                        const speed = 0.5 + Math.random() * 0.5;
                        const dx = targetX - startX;
                        const dy = 360;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        
                        game.missiles.push({
                            x: startX,
                            y: 0,
                            vx: (dx / dist) * speed,
                            vy: (dy / dist) * speed,
                            trail: []
                        });
                    }
                }, i * (1000 / numMissiles));
            }
        }

        function createExplosion(x, y, color, maxSize) {
            game.explosions.push({
                x: x,
                y: y,
                size: 0,
                maxSize: maxSize,
                growth: 2,
                life: 30,
                color: color
            });
        }

        function handleCanvasClick(e) {
            if (!game.gameRunning || game.gamePaused) return;
            
            const rect = game.canvas.getBoundingClientRect();
            const scaleX = game.canvas.width / rect.width;
            const scaleY = game.canvas.height / rect.height;
            
            const targetX = (e.clientX - rect.left) * scaleX;
            const targetY = (e.clientY - rect.top) * scaleY;
            
            fireMissile(targetX, targetY);
        }

        function handleTouchStart(e) {
            e.preventDefault();
            if (!game.gameRunning || game.gamePaused) return;
            
            const rect = game.canvas.getBoundingClientRect();
            const scaleX = game.canvas.width / rect.width;
            const scaleY = game.canvas.height / rect.height;
           
           const touch = e.touches[0];
           const targetX = (touch.clientX - rect.left) * scaleX;
           const targetY = (touch.clientY - rect.top) * scaleY;
           
           fireMissile(targetX, targetY);
       }

       function handleMouseMove(e) {
           if (!game.gameRunning) return;
           
           const rect = game.canvas.getBoundingClientRect();
           const scaleX = game.canvas.width / rect.width;
           const scaleY = game.canvas.height / rect.height;
           
           game.crosshair.x = (e.clientX - rect.left) * scaleX;
           game.crosshair.y = (e.clientY - rect.top) * scaleY;
       }

       function fireMissile(targetX, targetY) {
           // Fire from the nearest missile base
           const bases = [
               { x: 50, y: 380 },
               { x: 300, y: 380 },
               { x: 550, y: 380 }
           ];
           
           // Find closest base
           let closestBase = bases[0];
           let minDist = Math.abs(targetX - bases[0].x);
           
           for (let i = 1; i < bases.length; i++) {
               const dist = Math.abs(targetX - bases[i].x);
               if (dist < minDist) {
                   minDist = dist;
                   closestBase = bases[i];
               }
           }
           
           const dx = targetX - closestBase.x;
           const dy = targetY - closestBase.y;
           const dist = Math.sqrt(dx * dx + dy * dy);
           
           game.defenseMissiles.push({
               x: closestBase.x,
               y: closestBase.y,
               targetX: targetX,
               targetY: targetY,
               vx: (dx / dist) * 4,
               vy: (dy / dist) * 4,
               trail: []
           });
           
           playSound("shoot");
       }

       function fireAtPosition(position) {
           if (!game.gameRunning || game.gamePaused) return;
           
           let targetX;
           switch(position) {
               case 'left': targetX = 150; break;
               case 'center': targetX = 300; break;
               case 'right': targetX = 450; break;
               default: targetX = 300;
           }
           
           const targetY = 200;
           fireMissile(targetX, targetY);
       }

       function render() {
           const ctx = game.ctx;
           
           // Clear canvas with gradient background
           const gradient = ctx.createLinearGradient(0, 0, 0, 400);
           gradient.addColorStop(0, "#0a0a0a");
           gradient.addColorStop(0.5, "#1a1a2e");
           gradient.addColorStop(1, "#2a2a4e");
           ctx.fillStyle = gradient;
           ctx.fillRect(0, 0, 600, 400);
           
           // Draw stars
           drawStars();
           
           // Draw ground
           ctx.fillStyle = "#2d5016";
           ctx.fillRect(0, 360, 600, 40);
           
           // Draw cities
           drawCities();
           
           // Draw missile bases
           drawMissileBases();
           
           // Draw missiles
           game.missiles.forEach(missile => {
               // Add to trail
               missile.trail.push({ x: missile.x, y: missile.y });
               if (missile.trail.length > 8) {
                   missile.trail.shift();
               }
               
               // Draw trail
               ctx.strokeStyle = "#ff4444";
               ctx.lineWidth = 2;
               ctx.beginPath();
               for (let i = 0; i < missile.trail.length - 1; i++) {
                   const alpha = i / missile.trail.length;
                   ctx.globalAlpha = alpha;
                   ctx.moveTo(missile.trail[i].x, missile.trail[i].y);
                   ctx.lineTo(missile.trail[i + 1].x, missile.trail[i + 1].y);
               }
               ctx.stroke();
               ctx.globalAlpha = 1;
               
               // Draw missile
               ctx.fillStyle = "#ff6666";
               ctx.beginPath();
               ctx.arc(missile.x, missile.y, 3, 0, Math.PI * 2);
               ctx.fill();
           });
           
           // Draw defense missiles
           game.defenseMissiles.forEach(missile => {
               // Add to trail
               missile.trail.push({ x: missile.x, y: missile.y });
               if (missile.trail.length > 6) {
                   missile.trail.shift();
               }
               
               // Draw trail
               ctx.strokeStyle = "#00ff00";
               ctx.lineWidth = 2;
               ctx.beginPath();
               for (let i = 0; i < missile.trail.length - 1; i++) {
                   const alpha = i / missile.trail.length;
                   ctx.globalAlpha = alpha;
                   ctx.moveTo(missile.trail[i].x, missile.trail[i].y);
                   ctx.lineTo(missile.trail[i + 1].x, missile.trail[i + 1].y);
               }
               ctx.stroke();
               ctx.globalAlpha = 1;
               
               // Draw missile
               ctx.fillStyle = "#66ff66";
               ctx.beginPath();
               ctx.arc(missile.x, missile.y, 2, 0, Math.PI * 2);
               ctx.fill();
           });
           
           // Draw explosions
           game.explosions.forEach(explosion => {
               const alpha = explosion.life / 30;
               ctx.globalAlpha = alpha;
               
               const gradient = ctx.createRadialGradient(
                   explosion.x, explosion.y, 0,
                   explosion.x, explosion.y, explosion.size
               );
               gradient.addColorStop(0, explosion.color);
               gradient.addColorStop(1, "transparent");
               
               ctx.fillStyle = gradient;
               ctx.beginPath();
               ctx.arc(explosion.x, explosion.y, explosion.size, 0, Math.PI * 2);
               ctx.fill();
               
               ctx.globalAlpha = 1;
           });
           
           // Draw crosshair (when game is running)
           if (game.gameRunning && !game.gamePaused && game.gameStarted) {
               ctx.strokeStyle = "#00ffff";
               ctx.lineWidth = 2;
               ctx.beginPath();
               ctx.moveTo(game.crosshair.x - 10, game.crosshair.y);
               ctx.lineTo(game.crosshair.x + 10, game.crosshair.y);
               ctx.moveTo(game.crosshair.x, game.crosshair.y - 10);
               ctx.lineTo(game.crosshair.x, game.crosshair.y + 10);
               ctx.stroke();
           }
           
           // Draw wave countdown
           if (game.nextWaveCountdown > 0 && game.gameRunning) {
               ctx.fillStyle = "#ffff00";
               ctx.font = "24px Orbitron";
               ctx.textAlign = "center";
               ctx.fillText("Next Wave: " + Math.ceil(game.nextWaveCountdown / 60), 300, 50);
           }
       }

       function drawStars() {
           const ctx = game.ctx;
           ctx.fillStyle = "#ffffff";
           
           // Fixed star positions for consistency
           const stars = [
               {x: 50, y: 30}, {x: 150, y: 60}, {x: 250, y: 20}, {x: 350, y: 80},
               {x: 450, y: 40}, {x: 550, y: 70}, {x: 100, y: 100}, {x: 300, y: 120},
               {x: 500, y: 90}, {x: 80, y: 150}, {x: 200, y: 140}, {x: 400, y: 160}
           ];
           
           stars.forEach(star => {
               ctx.beginPath();
               ctx.arc(star.x, star.y, 1, 0, Math.PI * 2);
               ctx.fill();
           });
       }

       function drawCities() {
           const ctx = game.ctx;
           const cityWidth = 70;
           const cityHeight = 30;
           
           for (let i = 0; i < 6; i++) {
               const x = 50 + i * 85;
               const y = 330;
               
               if (i < game.cities) {
                   // Draw intact city
                   ctx.fillStyle = "#4a90e2";
                   ctx.fillRect(x, y, cityWidth, cityHeight);
                   
                   // Add building details
                   ctx.fillStyle = "#2a70c2";
                   for (let j = 0; j < 3; j++) {
                       const buildingX = x + j * 20 + 5;
                       const buildingHeight = 15 + Math.random() * 10;
                       ctx.fillRect(buildingX, y + cityHeight - buildingHeight, 15, buildingHeight);
                   }
                   
                   // Add windows
                   ctx.fillStyle = "#ffff88";
                   for (let j = 0; j < 6; j++) {
                       const windowX = x + (j % 3) * 20 + 8;
                       const windowY = y + Math.floor(j / 3) * 8 + 8;
                       ctx.fillRect(windowX, windowY, 3, 3);
                   }
               } else {
                   // Draw destroyed city
                   ctx.fillStyle = "#444";
                   ctx.fillRect(x, y + 20, cityWidth, 10);
                   
                   // Add rubble
                   ctx.fillStyle = "#666";
                   for (let j = 0; j < 5; j++) {
                       const rubbleX = x + Math.random() * cityWidth;
                       const rubbleY = y + 15 + Math.random() * 10;
                       ctx.fillRect(rubbleX, rubbleY, 5, 5);
                   }
               }
           }
       }

       function drawMissileBases() {
           const ctx = game.ctx;
           const bases = [
               { x: 50, y: 380 },
               { x: 300, y: 380 },
               { x: 550, y: 380 }
           ];
           
           bases.forEach(base => {
               // Draw base structure
               ctx.fillStyle = "#8B4513";
               ctx.fillRect(base.x - 15, base.y - 10, 30, 20);
               
               // Draw missile launcher
               ctx.fillStyle = "#2F4F2F";
               ctx.fillRect(base.x - 5, base.y - 20, 10, 15);
               
               // Draw launch tube
               ctx.fillStyle = "#000000";
               ctx.fillRect(base.x - 3, base.y - 18, 6, 10);
           });
       }

       function handleKeyPress(e) {
           switch(e.code) {
               case "Space":
                   e.preventDefault();
                   if (game.gameStarted) {
                       togglePause();
                   }
                   break;
               case "KeyN":
                   e.preventDefault();
                   startNewGame();
                   break;
               case "Escape":
                   e.preventDefault();
                   if (game.gameStarted) {
                       togglePause();
                   }
                   break;
           }
       }

       function togglePause() {
           if (!game.gameStarted) return;
           
           game.gamePaused = !game.gamePaused;
           const pauseButton = document.getElementById("pauseButton");
           
           if (game.gamePaused) {
               pauseButton.textContent = "▶️ Resume";
               pauseButton.classList.add("pulse");
           } else {
               pauseButton.textContent = "⏸️ Pause";
               pauseButton.classList.remove("pulse");
               gameLoop(); // Resume game loop
           }
       }

       function updateDisplay() {
           document.getElementById("currentScore").textContent = game.score.toLocaleString();
           document.getElementById("currentLevel").textContent = game.level;
           document.getElementById("citiesLeft").textContent = game.cities;
           
           // Update best score if needed
           if (game.score > game.bestScore) {
               game.bestScore = game.score;
               localStorage.setItem("missileCommandBest", game.bestScore);
               document.getElementById("bestScore").textContent = game.bestScore.toLocaleString();
           }
       }

       function endGame() {
           game.gameRunning = false;
           game.gameStarted = false;
           
           // Show game over modal
           document.getElementById("finalScore").textContent = game.score.toLocaleString();
           document.getElementById("finalLevel").textContent = game.level;
           document.getElementById("gameOverModal").style.display = "flex";
           
           trackEvent("game_over", {
               score: game.score,
               level: game.level,
               cities_saved: game.cities
           });
       }

       function closeModal() {
           document.getElementById("gameOverModal").style.display = "none";
       }

       function showLeaderboard() {
           const scores = JSON.parse(localStorage.getItem("missileCommandScores") || "[]");
           
           let message = "🏆 Missile Command Leaderboard 🏆\n\n";
           if (scores.length === 0) {
               message += "No scores yet. Be the first!";
           } else {
               scores.slice(0, 5).forEach((score, index) => {
                   message += `#${index + 1}: ${score.toLocaleString()} pts\n`;
               });
           }
           
           alert(message);
       }

       function shareScore() {
           const text = `🚀 I just scored ${game.score.toLocaleString()} points defending cities in Missile Command! Can you beat my score? 🏆`;
           
           if (navigator.share) {
               navigator.share({
                   title: "Missile Command - My Score",
                   text: text,
                   url: window.location.href
               });
           } else {
               navigator.clipboard.writeText(text + " " + window.location.href).then(() => {
                   alert("Score copied to clipboard! Share it with your friends!");
               });
           }
       }

       function showInstructions() {
           alert(`🚀 Missile Command - How to Play

🎯 Objective:
Defend your cities from incoming enemy missiles!

🕹️ Controls:
- Click or tap anywhere to fire defensive missiles
- Use mobile buttons for quick targeting
- Spacebar or Escape to pause/resume
- N for new game

🎮 Gameplay:
- Enemy missiles fall from the sky toward your cities
- Fire defensive missiles to intercept them
- Create explosions that destroy nearby missiles
- Survive waves to advance levels
- Don't let all cities be destroyed!

💰 Scoring:
- 25 points per missile destroyed (x level multiplier)
- 100 bonus points per surviving city (x level)
- Higher levels = faster missiles & more points

Good luck, Commander! 🍀`);
       }

       function toggleFullscreen() {
           if (!document.fullscreenElement) {
               document.documentElement.requestFullscreen().catch(err => {
                   console.log("Fullscreen not supported");
               });
           } else {
               document.exitFullscreen();
           }
       }

       // Utility Functions
       function playSound(type) {
           // Simple sound synthesis for better UX
           if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
               try {
                   const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                   const oscillator = audioContext.createOscillator();
                   const gainNode = audioContext.createGain();
                   
                   oscillator.connect(gainNode);
                   gainNode.connect(audioContext.destination);
                   
                   switch(type) {
                       case "shoot":
                           oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                           oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                           gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                           gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                           break;
                       case "explosion":
                           oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                           oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.3);
                           gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                           gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                           break;
                       case "hit":
                           oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                           oscillator.frequency.exponentialRampToValueAtTime(2000, audioContext.currentTime + 0.1);
                           gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                           gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                           break;
                   }
                   
                   oscillator.start(audioContext.currentTime);
                   oscillator.stop(audioContext.currentTime + 0.3);
               } catch (e) {
                   // Sound not supported, continue silently
               }
           }
       }

       function trackEvent(eventName, data = {}) {
           // Analytics tracking for engagement
           if (typeof gtag !== 'undefined') {
               gtag('event', eventName, {
                   event_category: 'missile_command_game',
                   ...data
               });
           }
           
           console.log(`Event: ${eventName}`, data);
       }

       // Initialize game when page loads
       document.addEventListener("DOMContentLoaded", () => {
           initGame();
       });

       // Prevent zoom on mobile
       let lastTouchEnd = 0;
       document.addEventListener("touchend", function (event) {
           const now = (new Date()).getTime();
           if (now - lastTouchEnd <= 300) {
               event.preventDefault();
           }
           lastTouchEnd = now;
       }, false);

       // Prevent context menu
       document.addEventListener("contextmenu", e => e.preventDefault());

       // Handle page visibility
       document.addEventListener("visibilitychange", () => {
           if (document.hidden && game.gameRunning && !game.gamePaused) {
               togglePause();
           }
       });

       console.log("🚀 Missile Command loaded successfully!");
   </script>
</body>
</html>