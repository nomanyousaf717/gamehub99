<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossword Master - Free HTML5 Puzzle Game | GameHub 99</title>
    <meta name="description" content="Play Crossword Master for free! Challenge your mind with this addictive crossword puzzle game! Mobile-friendly browser game with no download required.">
    <meta name="keywords" content="crossword master, crossword puzzle, word game, html5 game, free online game, browser game, mobile game, puzzle game">
    <meta name="author" content="GameHub 99">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="game">
    <meta property="og:url" content="https://gamehub99.com/games/crossword-master.html">
    <meta property="og:title" content="Crossword Master - Free HTML5 Puzzle Game">
    <meta property="og:description" content="Challenge your mind with this addictive crossword puzzle game!">
    <meta property="og:image" content="https://gamehub99.com/assets/crossword-master-og.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://gamehub99.com/games/crossword-master.html">
    <meta property="twitter:title" content="Crossword Master - Free HTML5 Puzzle Game">
    <meta property="twitter:description" content="Challenge your mind with this addictive crossword puzzle game!">
    <meta property="twitter:image" content="https://gamehub99.com/assets/crossword-master-og.jpg">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --bg-primary: #ecf0f1;
            --bg-secondary: #ffffff;
            --border-color: #bdc3c7;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Ad Space */
        .ad-space {
            width: 100%;
            height: 90px;
            background: var(--bg-secondary);
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .game-container {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            position: relative;
        }

        .crossword-grid {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            gap: 1px;
            background: var(--border-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            margin: 20px 0;
            max-width: 600px;
            margin: 20px auto;
        }

        .crossword-cell {
            aspect-ratio: 1;
            background: white;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .crossword-cell.black {
            background: var(--primary-color);
            cursor: default;
        }

        .crossword-cell.active {
            background: var(--secondary-color);
            color: white;
        }

        .crossword-cell.highlighted {
            background: rgba(52, 152, 219, 0.3);
        }

        .crossword-cell input {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            text-align: center;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            outline: none;
        }

        .cell-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 0.6rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .clues-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .clues-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .clues-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            text-align: center;
        }

        .clue-item {
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .clue-item:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .clue-item.active {
            background: var(--secondary-color);
            color: white;
        }

        .clue-number {
            font-weight: bold;
            color: var(--accent-color);
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background: var(--accent-color);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            z-index: 10;
        }

        .start-overlay h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .instructions {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: var(--shadow);
        }

        .instructions h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }

        .instructions ul {
            list-style: none;
            padding: 0;
        }

        .instructions li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .instructions li:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .crossword-grid {
                grid-template-columns: repeat(10, 1fr);
                max-width: 100%;
            }

            .clues-container {
                grid-template-columns: 1fr;
            }

            .game-controls {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 200px;
            }
        }

        @media (max-width: 480px) {
            .crossword-grid {
                grid-template-columns: repeat(8, 1fr);
            }

            .crossword-cell {
                font-size: 0.7rem;
            }

            .cell-number {
                font-size: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ad Space Top -->
        <div class="ad-space">
            [Advertisement Space - 728x90]
        </div>

        <div class="header">
            <h1>🧩 Crossword Master</h1>
            <p>Challenge your mind with this addictive crossword puzzle game!</p>
        </div>

        <div class="game-stats">
            <div class="stat-item">
                <div class="stat-label">Score</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Words Found</div>
                <div class="stat-value" id="wordsFound">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Time</div>
                <div class="stat-value" id="timer">00:00</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Level</div>
                <div class="stat-value" id="level">1</div>
            </div>
        </div>

        <div class="game-container">
            <div class="start-overlay" id="startOverlay">
                <h2>🧩 Ready to Play?</h2>
                <p>Fill in the crossword puzzle using the clues provided!</p>
                <button class="btn btn-primary" onclick="startGame()">Start Game</button>
            </div>

            <div class="crossword-grid" id="crosswordGrid"></div>

            <div class="clues-container">
                <div class="clues-section">
                    <div class="clues-title">Across</div>
                    <div id="acrossClues"></div>
                </div>
                <div class="clues-section">
                    <div class="clues-title">Down</div>
                    <div id="downClues"></div>
                </div>
            </div>

            <div class="game-controls">
                <button class="btn btn-primary" onclick="checkPuzzle()">Check Puzzle</button>
                <button class="btn btn-warning" onclick="getHint()">Get Hint</button>
                <button class="btn btn-success" onclick="newPuzzle()">New Puzzle</button>
                <button class="btn btn-danger" onclick="clearPuzzle()">Clear All</button>
            </div>
        </div>

        <div class="instructions">
            <h3>How to Play</h3>
            <ul>
                <li>📝 Click on a cell to start typing</li>
                <li>🔍 Use the clues to fill in words</li>
                <li>⬅️➡️ Click on clues to highlight word positions</li>
                <li>✅ Check your answers with the Check button</li>
                <li>💡 Get hints when you're stuck</li>
                <li>🏆 Complete the puzzle to advance to the next level</li>
            </ul>
        </div>

        <!-- Ad Space Bottom -->
        <div class="ad-space">
            [Advertisement Space - 728x90]
        </div>
    </div>

    <!-- Game Over Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2>🎉 Puzzle Completed!</h2>
            <p>Congratulations! You've solved the crossword!</p>
            <div id="finalStats"></div>
            <button class="btn btn-primary" onclick="nextLevel()">Next Level</button>
            <button class="btn btn-success" onclick="newPuzzle()">New Puzzle</button>
        </div>
    </div>

    <script>
        // Game State
        const game = {
            grid: [],
            answers: [],
            clues: [],
            currentCell: null,
            currentWord: null,
            score: 0,
            wordsFound: 0,
            level: 1,
            startTime: null,
            timer: null,
            gameStarted: false,
            hints: 3
        };

        // Sample puzzles for different levels
        const puzzles = [
            {
                size: { rows: 8, cols: 8 },
                words: [
                    { word: "CAT", row: 0, col: 0, direction: "across", clue: "Feline pet" },
                    { word: "DOG", row: 2, col: 0, direction: "across", clue: "Man's best friend" },
                    { word: "SUN", row: 4, col: 2, direction: "across", clue: "Star in our solar system" },
                    { word: "TREE", row: 1, col: 1, direction: "down", clue: "Tall plant with branches" },
                    { word: "BOOK", row: 0, col: 4, direction: "down", clue: "Something you read" }
                ]
            },
            {
                size: { rows: 10, cols: 10 },
                words: [
                    { word: "HOUSE", row: 0, col: 0, direction: "across", clue: "Place where you live" },
                    { word: "WATER", row: 2, col: 1, direction: "across", clue: "H2O" },
                    { word: "PHONE", row: 4, col: 3, direction: "across", clue: "Device for calling" },
                    { word: "MUSIC", row: 1, col: 2, direction: "down", clue: "Art of sound" },
                    { word: "HAPPY", row: 0, col: 6, direction: "down", clue: "Joyful emotion" }
                ]
            }
        ];

        // Initialize game
        function initGame() {
            setupEventListeners();
            loadHighScore();
        }

        function setupEventListeners() {
            document.addEventListener('keydown', handleKeyPress);
            
            // Prevent context menu on long touch
            document.addEventListener('contextmenu', (e) => e.preventDefault());
        }

        function startGame() {
            document.getElementById('startOverlay').style.display = 'none';
            game.gameStarted = true;
            game.startTime = Date.now();
            startTimer();
            generatePuzzle();
            trackEvent('game_started');
        }

        function generatePuzzle() {
            const puzzle = puzzles[(game.level - 1) % puzzles.length];
            game.grid = createEmptyGrid(puzzle.size.rows, puzzle.size.cols);
            game.answers = JSON.parse(JSON.stringify(game.grid));
            game.clues = [];

            // Place words in the grid
            puzzle.words.forEach((wordData, index) => {
                placeWordInGrid(wordData, index + 1);
            });

            renderGrid();
            renderClues();
        }

        function createEmptyGrid(rows, cols) {
            const grid = [];
            for (let i = 0; i < rows; i++) {
                grid[i] = [];
                for (let j = 0; j < cols; j++) {
                    grid[i][j] = { 
                        letter: '', 
                        isBlack: true, 
                        number: null,
                        answer: '',
                        wordIds: []
                    };
                }
            }
            return grid;
        }

        function placeWordInGrid(wordData, wordId) {
            const { word, row, col, direction, clue } = wordData;
            
            // Mark cells as active and place letters
            for (let i = 0; i < word.length; i++) {
                const r = direction === 'across' ? row : row + i;
                const c = direction === 'across' ? col + i : col;
                
                if (r < game.grid.length && c < game.grid[0].length) {
                    game.grid[r][c].isBlack = false;
                    game.grid[r][c].answer = word[i];
                    game.grid[r][c].wordIds.push(wordId);
                    
                    if (i === 0) {
                        game.grid[r][c].number = wordId;
                    }
                }
            }

            // Add clue
            game.clues.push({
                id: wordId,
                number: wordId,
                clue: clue,
                direction: direction,
                word: word,
                row: row,
                col: col,
                completed: false
            });
        }

        function renderGrid() {
            const gridElement = document.getElementById('crosswordGrid');
            gridElement.innerHTML = '';
            
            const rows = game.grid.length;
            const cols = game.grid[0].length;
            gridElement.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const cell = game.grid[i][j];
                    const cellElement = document.createElement('div');
                    cellElement.className = 'crossword-cell';
                    cellElement.dataset.row = i;
                    cellElement.dataset.col = j;

                    if (cell.isBlack) {
                        cellElement.classList.add('black');
                    } else {
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.maxLength = 1;
                        input.addEventListener('input', handleCellInput);
                        input.addEventListener('focus', handleCellFocus);
                        input.addEventListener('keydown', handleCellKeyDown);
                        cellElement.appendChild(input);

                        if (cell.number) {
                            const numberElement = document.createElement('div');
                            numberElement.className = 'cell-number';
                            numberElement.textContent = cell.number;
                            cellElement.appendChild(numberElement);
                        }
                    }

                    cellElement.addEventListener('click', () => handleCellClick(i, j));
                    gridElement.appendChild(cellElement);
                }
            }
        }

        function renderClues() {
            const acrossClues = document.getElementById('acrossClues');
            const downClues = document.getElementById('downClues');
            
            acrossClues.innerHTML = '';
            downClues.innerHTML = '';

            game.clues.forEach(clueData => {
                const clueElement = document.createElement('div');
                clueElement.className = 'clue-item';
                clueElement.dataset.clueId = clueData.id;
                clueElement.innerHTML = `<span class="clue-number">${clueData.number}.</span> ${clueData.clue}`;
                
                clueElement.addEventListener('click', () => selectWord(clueData));

                if (clueData.direction === 'across') {
                    acrossClues.appendChild(clueElement);
                } else {
                    downClues.appendChild(clueElement);
                }
            });
        }

        function handleCellClick(row, col) {
            if (game.grid[row][col].isBlack) return;
            
            selectCell(row, col);
        }

        function handleCellFocus(e) {
            const cell = e.target.closest('.crossword-cell');
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            selectCell(row, col);
        }

        function handleCellInput(e) {
            const input = e.target;
            const cell = input.closest('.crossword-cell');
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            
            const letter = e.target.value.toUpperCase();
            game.grid[row][col].letter = letter;
            
            if (letter) {
                moveToNextCell(row, col);
                checkWordCompletion();
            }
        }

        function handleCellKeyDown(e) {
            if (e.key === 'Backspace' && !e.target.value) {
                moveToPreviousCell();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                moveCell('up');
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                moveCell('down');
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                moveCell('left');
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                moveCell('right');
            }
        }

        function selectCell(row, col) {
            // Clear previous selection
            document.querySelectorAll('.crossword-cell').forEach(cell => {
                cell.classList.remove('active', 'highlighted');
            });
            document.querySelectorAll('.clue-item').forEach(clue => {
                clue.classList.remove('active');
            });

            game.currentCell = { row, col };
            
            // Highlight current cell
            const cellElement = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            cellElement.classList.add('active');
            
            // Find and highlight word
            const wordIds = game.grid[row][col].wordIds;
            if (wordIds.length > 0) {
                const wordId = wordIds[0]; // Use first word for now
                highlightWord(wordId);
            }
        }

        function selectWord(clueData) {
            game.currentWord = clueData;
            
            // Clear previous selection
            document.querySelectorAll('.crossword-cell').forEach(cell => {
                cell.classList.remove('active', 'highlighted');
            });
            document.querySelectorAll('.clue-item').forEach(clue => {
                clue.classList.remove('active');
            });

            // Highlight clue
            document.querySelector(`[data-clue-id="${clueData.id}"]`).classList.add('active');
            
            // Highlight word cells
            highlightWord(clueData.id);
            
            // Focus first empty cell of the word
            focusFirstEmptyCell(clueData);
        }

        function highlightWord(wordId) {
            const clueData = game.clues.find(c => c.id === wordId);
            if (!clueData) return;

            for (let i = 0; i < clueData.word.length; i++) {
                const r = clueData.direction === 'across' ? clueData.row : clueData.row + i;
                const c = clueData.direction === 'across' ? clueData.col + i : clueData.col;
                
                const cellElement = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                if (cellElement) {
                    cellElement.classList.add('highlighted');
                }
            }
        }

        function focusFirstEmptyCell(clueData) {
            for (let i = 0; i < clueData.word.length; i++) {
                const r = clueData.direction === 'across' ? clueData.row : clueData.row + i;
                const c = clueData.direction === 'across' ? clueData.col + i : clueData.col;
                
                if (!game.grid[r][c].letter) {
                    const cellElement = document.querySelector(`[data-row="${r}"][data-col="${c}"] input`);
                    if (cellElement) {
                        cellElement.focus();
                        selectCell(r, c);
                        break;
                    }
                }
            }
        }

        function moveToNextCell(row, col) {
            if (!game.currentWord) return;
            
            const clueData = game.currentWord;
            const currentIndex = clueData.direction === 'across' ? col - clueData.col : row - clueData.row;
            
            if (currentIndex < clueData.word.length - 1) {
                const nextR = clueData.direction === 'across' ? row : row + 1;
                const nextC = clueData.direction === 'across' ? col + 1 : col;
                
                const nextCell = document.querySelector(`[data-row="${nextR}"][data-col="${nextC}"] input`);
                if (nextCell) {
                    nextCell.focus();
                    selectCell(nextR, nextC);
                }
            }
        }

        function moveToPreviousCell() {
            if (!game.currentCell || !game.currentWord) return;
            
            const { row, col } = game.currentCell;
            const clueData = game.currentWord;
            const currentIndex = clueData.direction === 'across' ? col - clueData.col : row - clueData.row;
            
            if (currentIndex > 0) {
                const prevR = clueData.direction === 'across' ? row : row - 1;
                const prevC = clueData.direction === 'across' ? col - 1 : col;
                
                const prevCell = document.querySelector(`[data-row="${prevR}"][data-col="${prevC}"] input`);
                if (prevCell) {
                    prevCell.focus();
                    prevCell.select();
                    selectCell(prevR, prevC);
                }
            }
        }

        function moveCell(direction) {
            if (!game.currentCell) return;
            
            const { row, col } = game.currentCell;
            let newRow = row, newCol = col;
            
            switch (direction) {
                case 'up':
                    newRow = Math.max(0, row - 1);
                    break;
                case 'down':
                    newRow = Math.min(game.grid.length - 1, row + 1);
                    break;
                case 'left':
                    newCol = Math.max(0, col - 1);
                    break;
                case 'right':
                    newCol = Math.min(game.grid[0].length - 1, col + 1);
                    break;
            }
            
            if (!game.grid[newRow][newCol].isBlack) {
                const nextCell = document.querySelector(`[data-row="${newRow}"][data-col="${newCol}"] input`);
                if (nextCell) {
                    nextCell.focus();
                    selectCell(newRow, newCol);
                }
            }
        }

        function checkWordCompletion() {
            game.clues.forEach(clueData => {
                if (clueData.completed) return;
                
                let isComplete = true;
                let userWord = '';
                
                for (let i = 0; i < clueData.word.length; i++) {
                    const r = clueData.direction === 'across' ? clueData.row : clueData.row + i;
                   const c = clueData.direction === 'across' ? clueData.col + i : clueData.col;
                   
                   const letter = game.grid[r][c].letter;
                   if (!letter) {
                       isComplete = false;
                       break;
                   }
                   userWord += letter;
               }
               
               if (isComplete && userWord === clueData.word) {
                   clueData.completed = true;
                   game.wordsFound++;
                   game.score += clueData.word.length * 10;
                   updateStats();
                   
                   // Visual feedback for completed word
                   for (let i = 0; i < clueData.word.length; i++) {
                       const r = clueData.direction === 'across' ? clueData.row : clueData.row + i;
                       const c = clueData.direction === 'across' ? clueData.col + i : clueData.col;
                       
                       const cellElement = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                       if (cellElement) {
                           cellElement.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
                           cellElement.style.color = 'white';
                       }
                   }
                   
                   // Mark clue as completed
                   const clueElement = document.querySelector(`[data-clue-id="${clueData.id}"]`);
                   if (clueElement) {
                       clueElement.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
                       clueElement.style.color = 'white';
                   }
                   
                   trackEvent('word_completed', { word: clueData.word, score: game.score });
               }
           });
           
           // Check if puzzle is complete
           if (game.clues.every(clue => clue.completed)) {
               setTimeout(completePuzzle, 500);
           }
       }

       function checkPuzzle() {
           let correctCells = 0;
           let totalCells = 0;
           
           for (let i = 0; i < game.grid.length; i++) {
               for (let j = 0; j < game.grid[0].length; j++) {
                   const cell = game.grid[i][j];
                   if (!cell.isBlack) {
                       totalCells++;
                       const cellElement = document.querySelector(`[data-row="${i}"][data-col="${j}"]`);
                       
                       if (cell.letter === cell.answer) {
                           correctCells++;
                           cellElement.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
                           cellElement.style.color = 'white';
                       } else if (cell.letter) {
                           cellElement.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                           cellElement.style.color = 'white';
                       }
                   }
               }
           }
           
           const accuracy = Math.round((correctCells / totalCells) * 100);
           showMessage(`Accuracy: ${accuracy}% (${correctCells}/${totalCells} correct)`);
           
           setTimeout(() => {
               // Reset cell colors after 2 seconds
               document.querySelectorAll('.crossword-cell').forEach(cell => {
                   if (!cell.classList.contains('black')) {
                       cell.style.background = '';
                       cell.style.color = '';
                   }
               });
           }, 2000);
           
           trackEvent('puzzle_checked', { accuracy: accuracy });
       }

       function getHint() {
           if (game.hints <= 0) {
               showMessage('No hints remaining!');
               return;
           }
           
           // Find an empty cell in an incomplete word
           let hintGiven = false;
           
           for (const clueData of game.clues) {
               if (clueData.completed) continue;
               
               for (let i = 0; i < clueData.word.length; i++) {
                   const r = clueData.direction === 'across' ? clueData.row : clueData.row + i;
                   const c = clueData.direction === 'across' ? clueData.col + i : clueData.col;
                   
                   if (!game.grid[r][c].letter) {
                       game.grid[r][c].letter = game.grid[r][c].answer;
                       const input = document.querySelector(`[data-row="${r}"][data-col="${c}"] input`);
                       if (input) {
                           input.value = game.grid[r][c].answer;
                       }
                       
                       game.hints--;
                       game.score -= 5; // Penalty for using hint
                       updateStats();
                       checkWordCompletion();
                       
                       showMessage(`Hint used! ${game.hints} hints remaining.`);
                       hintGiven = true;
                       break;
                   }
               }
               
               if (hintGiven) break;
           }
           
           if (!hintGiven) {
               showMessage('No hints needed - puzzle is complete!');
           }
           
           trackEvent('hint_used', { hintsRemaining: game.hints });
       }

       function clearPuzzle() {
           if (confirm('Are you sure you want to clear all your answers?')) {
               for (let i = 0; i < game.grid.length; i++) {
                   for (let j = 0; j < game.grid[0].length; j++) {
                       game.grid[i][j].letter = '';
                       const input = document.querySelector(`[data-row="${i}"][data-col="${j}"] input`);
                       if (input) {
                           input.value = '';
                       }
                   }
               }
               
               // Reset completed status
               game.clues.forEach(clue => clue.completed = false);
               game.wordsFound = 0;
               game.score = Math.max(0, game.score - 20); // Penalty for clearing
               updateStats();
               
               // Reset visual styles
               document.querySelectorAll('.crossword-cell, .clue-item').forEach(element => {
                   element.style.background = '';
                   element.style.color = '';
               });
               
               trackEvent('puzzle_cleared');
           }
       }

       function newPuzzle() {
           if (confirm('Start a new puzzle? Current progress will be lost.')) {
               resetGame();
               generatePuzzle();
               trackEvent('new_puzzle_started');
           }
       }

       function nextLevel() {
           game.level++;
           game.hints = 3; // Reset hints for new level
           resetPuzzleState();
           generatePuzzle();
           closeModal();
           showMessage(`Level ${game.level} started!`);
           trackEvent('level_advanced', { level: game.level });
       }

       function completePuzzle() {
           const timeTaken = Math.floor((Date.now() - game.startTime) / 1000);
           const timeBonus = Math.max(0, 300 - timeTaken); // Bonus for completing quickly
           game.score += timeBonus;
           
           updateStats();
           saveHighScore();
           
           const modal = document.getElementById('gameOverModal');
           const finalStats = document.getElementById('finalStats');
           
           finalStats.innerHTML = `
               <p><strong>Final Score:</strong> ${game.score}</p>
               <p><strong>Time:</strong> ${formatTime(timeTaken)}</p>
               <p><strong>Words Found:</strong> ${game.wordsFound}</p>
               <p><strong>Level:</strong> ${game.level}</p>
               <p><strong>Time Bonus:</strong> +${timeBonus}</p>
           `;
           
           modal.style.display = 'flex';
           
           trackEvent('puzzle_completed', {
               score: game.score,
               time: timeTaken,
               level: game.level,
               wordsFound: game.wordsFound
           });
       }

       function resetGame() {
           game.score = 0;
           game.wordsFound = 0;
           game.level = 1;
           game.hints = 3;
           resetPuzzleState();
       }

       function resetPuzzleState() {
           game.grid = [];
           game.answers = [];
           game.clues = [];
           game.currentCell = null;
           game.currentWord = null;
           game.startTime = Date.now();
       }

       function updateStats() {
           document.getElementById('score').textContent = game.score;
           document.getElementById('wordsFound').textContent = game.wordsFound;
           document.getElementById('level').textContent = game.level;
       }

       function startTimer() {
           game.timer = setInterval(() => {
               if (!game.gameStarted) return;
               
               const elapsed = Math.floor((Date.now() - game.startTime) / 1000);
               document.getElementById('timer').textContent = formatTime(elapsed);
           }, 1000);
       }

       function formatTime(seconds) {
           const mins = Math.floor(seconds / 60);
           const secs = seconds % 60;
           return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
       }

       function handleKeyPress(e) {
           if (!game.gameStarted) return;
           
           if (e.key === 'Escape') {
               closeModal();
           }
       }

       function showMessage(text) {
           // Create temporary message overlay
           const message = document.createElement('div');
           message.style.cssText = `
               position: fixed;
               top: 50%;
               left: 50%;
               transform: translate(-50%, -50%);
               background: var(--primary-color);
               color: white;
               padding: 15px 25px;
               border-radius: 8px;
               font-weight: bold;
               z-index: 2000;
               box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
           `;
           message.textContent = text;
           
           document.body.appendChild(message);
           
           setTimeout(() => {
               message.remove();
           }, 2000);
       }

       function closeModal() {
           document.getElementById('gameOverModal').style.display = 'none';
       }

       function saveHighScore() {
           const highScore = localStorage.getItem('crosswordMasterHighScore') || 0;
           if (game.score > highScore) {
               localStorage.setItem('crosswordMasterHighScore', game.score);
               localStorage.setItem('crosswordMasterLevel', game.level);
               showMessage('New High Score!');
           }
       }

       function loadHighScore() {
           const highScore = localStorage.getItem('crosswordMasterHighScore') || 0;
           const highLevel = localStorage.getItem('crosswordMasterLevel') || 1;
           
           if (highScore > 0) {
               showMessage(`High Score: ${highScore} (Level ${highLevel})`);
           }
       }

       // Analytics tracking
       function trackEvent(eventName, properties = {}) {
           // Google Analytics 4 event tracking
           if (typeof gtag !== 'undefined') {
               gtag('event', eventName, {
                   game_name: 'crossword_master',
                   ...properties
               });
           }
           
           // Custom analytics can be added here
           console.log(`Event: ${eventName}`, properties);
       }

       // Prevent zoom on double tap (iOS)
       let lastTouchEnd = 0;
       document.addEventListener('touchend', function (event) {
           const now = (new Date()).getTime();
           if (now - lastTouchEnd <= 300) {
               event.preventDefault();
           }
           lastTouchEnd = now;
       }, false);

       // Initialize game when page loads
       document.addEventListener('DOMContentLoaded', initGame);

       // Prevent page refresh on pull-down
       document.body.addEventListener('touchstart', function(e) {
           if (e.touches.length === 1 && e.touches[0].clientY === 0) {
               e.preventDefault();
           }
       });

       document.body.addEventListener('touchmove', function(e) {
           if (e.touches.length === 1 && e.touches[0].clientY === 0) {
               e.preventDefault();
           }
       });
   </script>

   <!-- Google AdSense -->
   <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
   
   <!-- Google Analytics 4 -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
   <script>
       window.dataLayer = window.dataLayer || [];
       function gtag(){dataLayer.push(arguments);}
       gtag('js', new Date());
       gtag('config', 'GA_MEASUREMENT_ID');
   </script>
</body>
</html>