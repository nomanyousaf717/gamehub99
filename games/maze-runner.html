<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maze Runner - Free HTML5 Game | GamesZone99</title>
    <meta name="description" content="Play Maze Runner for free! Navigate through challenging mazes, collect coins, and beat your high score! Mobile-friendly browser game with no download required.">
    <meta name="keywords" content="maze runner, puzzle game, html5 game, free online game, browser game, mobile game, maze game">
    <meta name="author" content="GamesZone99">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="game">
    <meta property="og:url" content="https://gameszone99.com/games/maze-runner.html">
    <meta property="og:title" content="Maze Runner - Free HTML5 Game">
    <meta property="og:description" content="Navigate through challenging mazes and beat your high score!">
    <meta property="og:image" content="https://gameszone99.com/assets/maze-runner-og.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://gameszone99.com/games/maze-runner.html">
    <meta property="twitter:title" content="Maze Runner - Free HTML5 Game">
    <meta property="twitter:description" content="Navigate through challenging mazes and beat your high score!">
    <meta property="twitter:image" content="https://gameszone99.com/assets/maze-runner-og.jpg">

    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --dark-gradient: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 100%);
            --accent-color: #00d4ff;
            --success-color: #00ff88;
            --warning-color: #ffaa00;
            --danger-color: #ff4757;
            --text-primary: #ffffff;
            --text-secondary: #b8c1ec;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --shadow-glow: 0 0 40px rgba(0, 212, 255, 0.3);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: "Inter", sans-serif;
            background: var(--dark-gradient);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .ad-container-top, .ad-container-bottom {
            width: 100%;
            min-height: 90px;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid var(--card-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .ad-placeholder {
            width: 728px;
            height: 90px;
            background: linear-gradient(45deg, #333, #555);
            border: 2px dashed #666;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
            border-radius: 8px;
        }

        .header {
            padding: 1rem 0;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--card-border);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .game-title {
            font-family: "Orbitron", monospace;
            font-size: 1.8rem;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: var(--shadow-glow);
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-button {
            padding: 8px 16px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 0.9rem;
        }

        .nav-button:hover {
            background: var(--accent-color);
            color: #000;
            transform: translateY(-2px);
        }

        .game-container {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            align-items: start;
        }

        .game-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-card);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .stats-section {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .stat-box {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            padding: 0.8rem 1rem;
            text-align: center;
            min-width: 80px;
            backdrop-filter: blur(10px);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.3rem;
        }

        .stat-value {
            font-family: "Orbitron", monospace;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .game-controls {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
        }

        .control-button {
            padding: 8px 16px;
            background: var(--secondary-gradient);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-card);
        }

        .control-button.new-game {
            background: var(--success-color);
        }

        .control-button.pause {
            background: var(--warning-color);
        }

        .game-canvas-container {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 15px;
            padding: 1rem;
            backdrop-filter: blur(10px);
            position: relative;
            text-align: center;
        }

        #gameCanvas {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid var(--card-border);
            border-radius: 10px;
            display: block;
            margin: 0 auto;
            max-width: 100%;
            height: auto;
        }

        .start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            z-index: 10;
        }

        .start-button {
            padding: 15px 30px;
            background: var(--success-color);
            border: none;
            border-radius: 12px;
            color: #000;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .start-button:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-glow);
        }

        .mobile-controls {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
            max-width: 250px;
            margin-left: auto;
            margin-right: auto;
        }

        .mobile-control {
            aspect-ratio: 1;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            user-select: none;
        }

        .mobile-control:hover, .mobile-control:active {
            background: var(--accent-color);
            color: #000;
            transform: scale(0.95);
        }

        .mobile-control.empty {
            visibility: hidden;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-card);
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent-color);
        }

        .instructions {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .instructions ul {
            list-style: none;
            padding-left: 0;
        }

        .instructions li {
            padding: 0.3rem 0;
            position: relative;
            padding-left: 1.5rem;
        }

        .instructions li:before {
            content: "🎯";
            position: absolute;
            left: 0;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .game-container {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .sidebar {
                order: -1;
            }
            
            .mobile-controls {
                display: grid;
            }
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 1rem;
            }
            
            .game-section, .sidebar-section {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .game-title {
                font-size: 1.5rem;
            }
            
            .stats-section {
                justify-content: center;
            }
            
            .ad-placeholder {
                width: 320px;
                height: 50px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .game-canvas-container {
                padding: 0.5rem;
            }
            
            #gameCanvas {
                width: 100%;
                height: auto;
            }
            
            .mobile-controls {
                gap: 0.5rem;
                max-width: 200px;
            }
            
            .mobile-control {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Top Ad Container -->
    <div class="ad-container-top">
        <div class="ad-placeholder">728x90 Header Advertisement</div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1 class="game-title">🏃‍♂️ Maze Runner</h1>
            <nav class="nav-buttons">
                <a href="/" class="nav-button">🏠 Home</a>
                <a href="/games" class="nav-button">🎮 More Games</a>
                <a href="#" class="nav-button" onclick="showInstructions()">❓ How to Play</a>
                <a href="#" class="nav-button" onclick="toggleFullscreen()">📱 Fullscreen</a>
            </nav>
        </div>
    </header>

    <!-- Main Game Container -->
    <div class="game-container">
        <!-- Game Section -->
        <main class="game-section">
            <div class="game-header">
                <div class="stats-section">
                    <div class="stat-box">
                        <div class="stat-label">Score</div>
                        <div class="stat-value" id="currentScore">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Best</div>
                        <div class="stat-value" id="bestScore">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Level</div>
                        <div class="stat-value" id="gameLevel">1</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Time</div>
                        <div class="stat-value" id="gameTime">0:00</div>
                    </div>
                </div>
                
                <div class="game-controls">
                    <button class="control-button new-game" onclick="newGame()">🆕 New Game</button>
                    <button class="control-button pause" onclick="togglePause()" id="pauseButton">⏸️ Pause</button>
                    <button class="control-button" onclick="showLeaderboard()">🏆 Scores</button>
                </div>
            </div>

            <!-- Game Canvas -->
            <div class="game-canvas-container">
                <canvas id="gameCanvas" width="600" height="600"></canvas>
                <div class="start-overlay" id="startOverlay">
                    <h2>🏃‍♂️ Maze Runner</h2>
                    <p>Navigate through the maze and collect coins!</p>
                    <button class="start-button" onclick="startGame()">🚀 Start Game</button>
                </div>
            </div>

            <!-- Mobile Controls -->
            <div class="mobile-controls">
                <div class="mobile-control empty"></div>
                <div class="mobile-control" onclick="moveUp()">⬆️</div>
                <div class="mobile-control empty"></div>
                <div class="mobile-control" onclick="moveLeft()">⬅️</div>
                <div class="mobile-control" onclick="moveDown()">⬇️</div>
                <div class="mobile-control" onclick="moveRight()">➡️</div>
                <div class="mobile-control empty"></div>
                <div class="mobile-control" onclick="newGame()">🆕</div>
                <div class="mobile-control empty"></div>
            </div>
        </main>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">🎯 How to Play</h3>
                <div class="instructions">
                    <p><strong>Navigate through challenging mazes and beat your high score!</strong></p>
                    <ul>
                        <li>Use arrow keys or swipe to move</li>
                        <li>Collect coins for points</li>
                        <li>Reach the exit to advance levels</li>
                        <li>Avoid getting stuck in dead ends</li>
                        <li>Beat your best time and score!</li>
                    </ul>
                </div>
            </div>

            <div class="sidebar-section" style="min-height: 250px; display: flex; align-items: center; justify-content: center;">
                <div style="width: 250px; height: 250px; background: linear-gradient(45deg, #333, #555); border: 2px dashed #666; display: flex; align-items: center; justify-content: center; color: #999; font-size: 14px; border-radius: 8px; text-align: center;">
                    300x250<br>Sidebar Ad
                </div>
            </div>
        </aside>
    </div>

    <!-- Bottom Ad Container -->
    <div class="ad-container-bottom">
        <div class="ad-placeholder">728x90 Footer Advertisement</div>
    </div>

    <script>
        // Game State
        const game = {
            canvas: null,
            ctx: null,
            score: 0,
            bestScore: localStorage.getItem("mazeRunnerBest") || 0,
            level: 1,
            gameRunning: false,
            gamePaused: false,
            gameOver: false,
            startTime: 0,
            elapsedTime: 0,
            timerInterval: null,
            cellSize: 20,
            maze: [],
            player: { x: 1, y: 1 },
            exit: { x: 0, y: 0 },
            coins: [],
            coinsCollected: 0,
            mazeWidth: 29,
            mazeHeight: 29
        };

        // Initialize game
        function initGame() {
            game.canvas = document.getElementById("gameCanvas");
            game.ctx = game.canvas.getContext("2d");
            
            // Load best score
            document.getElementById("bestScore").textContent = game.bestScore;
            
            // Setup controls
            setupEventListeners();
            setupTouchControls();
            
            // Generate initial maze
            generateMaze();
            drawGame();
            
            console.log("🎮 Maze Runner initialized!");
        }

        // Generate maze using recursive backtracking
        function generateMaze() {
            const width = game.mazeWidth;
            const height = game.mazeHeight;
            
            // Initialize maze with walls
            game.maze = Array(height).fill().map(() => Array(width).fill(1));
            
            // Carve maze
            const stack = [];
            const start = { x: 1, y: 1 };
            game.maze[start.y][start.x] = 0;
            stack.push(start);
            
            while (stack.length > 0) {
                const current = stack[stack.length - 1];
                const neighbors = getUnvisitedNeighbors(current.x, current.y);
                
                if (neighbors.length > 0) {
                    const next = neighbors[Math.floor(Math.random() * neighbors.length)];
                    
                    // Remove wall between current and next
                    const wallX = current.x + (next.x - current.x) / 2;
                    const wallY = current.y + (next.y - current.y) / 2;
                    game.maze[wallY][wallX] = 0;
                    game.maze[next.y][next.x] = 0;
                    
                    stack.push(next);
                } else {
                    stack.pop();
                }
            }
            
            // Set player start position
            game.player = { x: 1, y: 1 };
            
            // Set exit position
            game.exit = { x: width - 2, y: height - 2 };
            game.maze[game.exit.y][game.exit.x] = 0;
            
            // Generate coins
            generateCoins();
        }

        function getUnvisitedNeighbors(x, y) {
            const neighbors = [];
            const directions = [
                { x: 0, y: -2 }, // Up
                { x: 2, y: 0 },  // Right
                { x: 0, y: 2 },  // Down
                { x: -2, y: 0 }  // Left
            ];
            
            for (const dir of directions) {
                const newX = x + dir.x;
                const newY = y + dir.y;
                
                if (newX > 0 && newX < game.mazeWidth - 1 && 
                    newY > 0 && newY < game.mazeHeight - 1 && 
                    game.maze[newY][newX] === 1) {
                    neighbors.push({ x: newX, y: newY });
                }
            }
            
            return neighbors;
        }

        function generateCoins() {
            game.coins = [];
            const coinCount = Math.min(15, game.level * 3);
            
            for (let i = 0; i < coinCount; i++) {
                let coinX, coinY;
                do {
                    coinX = Math.floor(Math.random() * game.mazeWidth);
                    coinY = Math.floor(Math.random() * game.mazeHeight);
                } while (
                    game.maze[coinY][coinX] === 1 || 
                    (coinX === game.player.x && coinY === game.player.y) ||
                    (coinX === game.exit.x && coinY === game.exit.y) ||
                    game.coins.some(coin => coin.x === coinX && coin.y === coinY)
                );
                
                game.coins.push({ x: coinX, y: coinY, collected: false });
            }
            
            game.coinsCollected = 0;
        }

        // Draw game
        function drawGame() {
            const ctx = game.ctx;
            const cellSize = game.cellSize;
            
            // Clear canvas
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, game.canvas.width, game.canvas.height);
            
            // Draw maze
            for (let y = 0; y < game.mazeHeight; y++) {
                for (let x = 0; x < game.mazeWidth; x++) {
                    if (game.maze[y][x] === 1) {
                        // Wall
                        ctx.fillStyle = '#4a5568';
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                        
                        // Wall border
                        ctx.strokeStyle = '#2d3748';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(x * cellSize, y * cellSize, cellSize, cellSize);
                    } else {
                        // Floor
                        ctx.fillStyle = '#2d3748';
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                    }
                }
            }
            
            // Draw coins
            game.coins.forEach(coin => {
                if (!coin.collected) {
                    ctx.fillStyle = '#ffd700';
                    ctx.beginPath();
                    ctx.arc(
                        coin.x * cellSize + cellSize / 2,
                        coin.y * cellSize + cellSize / 2,
                        cellSize / 4,
                        0,
                        2 * Math.PI
                    );
                    ctx.fill();
                    
                    // Coin shine
                    ctx.fillStyle = '#ffff00';
                    ctx.beginPath();
                    ctx.arc(
                        coin.x * cellSize + cellSize / 2 - 2,
                        coin.y * cellSize + cellSize / 2 - 2,
                        cellSize / 8,
                        0,
                        2 * Math.PI
                    );
                    ctx.fill();
                }
            });
            
            // Draw exit
            ctx.fillStyle = '#00ff88';
            ctx.fillRect(
                game.exit.x * cellSize + 2,
                game.exit.y * cellSize + 2,
                cellSize - 4,
                cellSize - 4
            );
            
            // Exit glow
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;
            ctx.strokeRect(
                game.exit.x * cellSize,
                game.exit.y * cellSize,
                cellSize,
                cellSize
            );
            
            // Draw player
            ctx.fillStyle = '#00d4ff';
            ctx.fillRect(
                game.player.x * cellSize + 2,
                game.player.y * cellSize + 2,
                cellSize - 4,
                cellSize - 4
            );
            
            // Player glow
            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            ctx.strokeRect(
                game.player.x * cellSize,
                game.player.y * cellSize,
                cellSize,
                cellSize
            );
        }

        // Start game
        function startGame() {
            document.getElementById("startOverlay").style.display = "none";
            game.gameRunning = true;
            game.gamePaused = false;
            game.gameOver = false;
            game.startTime = Date.now();
            startTimer();
            trackEvent("game_start", { level: game.level });
        }

        // New game
        function newGame() {
            game.score = 0;
            game.level = 1;
            game.coinsCollected = 0;
            game.gameRunning = false;
            game.gamePaused = false;
            game.gameOver = false;
            
            updateUI();
            generateMaze();
            drawGame();
            
            document.getElementById("startOverlay").style.display = "flex";
            stopTimer();
            
            trackEvent("new_game");
        }

        // Move player
        function movePlayer(direction) {
            if (!game.gameRunning || game.gamePaused) return;
            
            let newX = game.player.x;
            let newY = game.player.y;
            
            switch (direction) {
                case "up": newY--; break;
                case "down": newY++; break;
                case "left": newX--; break;
                case "right": newX++; break;
            }
            
            // Check bounds and walls
            if (newX >= 0 && newX < game.mazeWidth && 
                newY >= 0 && newY < game.mazeHeight && 
                game.maze[newY][newX] === 0) {
                
                game.player.x = newX;
                game.player.y = newY;
                
                // Check coin collection
                checkCoinCollection();
                
                // Check if reached exit
                if (game.player.x === game.exit.x && game.player.y === game.exit.y) {
                    levelComplete();
                }
                
                drawGame();
                trackEvent("player_move", { direction: direction });
            }
        }

        function checkCoinCollection() {
            game.coins.forEach(coin => {
                if (!coin.collected && 
                    coin.x === game.player.x && 
                    coin.y === game.player.y) {
                    coin.collected = true;
                    game.coinsCollected++;
                    game.score += 10 * game.level;
                    updateUI();
                    trackEvent("coin_collected", { score: game.score });
                }
            });
        }

        function levelComplete() {
            game.level++;
            game.score += 100 * game.level;
            game.score += Math.max(0, 1000 - game.elapsedTime) * game.level; // Time bonus
            
            updateUI();
            showLevelComplete();
            
            setTimeout(() => {
                generateMaze();
                drawGame();
            }, 2000);
            
            trackEvent("level_complete", { level: game.level, score: game.score });
        }

        // Mobile control functions
        function moveUp() { movePlayer("up"); }
        function moveDown() { movePlayer("down"); }
        function moveLeft() { movePlayer("left"); }
        function moveRight() { movePlayer("right"); }

        // Game controls
        function togglePause() {
            if (!game.gameRunning) return;
            
            game.gamePaused = !game.gamePaused;
            const button = document.getElementById("pauseButton");
            
            if (game.gamePaused) {
                button.textContent = "▶️ Resume";
                stopTimer();
                showModal("Game Paused", "Click Resume to continue playing!", [
                    { text: "Resume", action: togglePause, primary: true }
                ]);
            } else {
                button.textContent = "⏸️ Pause";
               startTimer();
               hideModal();
           }
           
           trackEvent("game_pause", { paused: game.gamePaused });
       }

       // Timer functions
       function startTimer() {
           if (game.timerInterval) clearInterval(game.timerInterval);
           
           game.timerInterval = setInterval(() => {
               if (!game.gamePaused && game.gameRunning) {
                   game.elapsedTime = Math.floor((Date.now() - game.startTime) / 1000);
                   updateTimer();
               }
           }, 1000);
       }

       function stopTimer() {
           if (game.timerInterval) {
               clearInterval(game.timerInterval);
               game.timerInterval = null;
           }
       }

       function updateTimer() {
           const minutes = Math.floor(game.elapsedTime / 60);
           const seconds = game.elapsedTime % 60;
           document.getElementById("gameTime").textContent = 
               `${minutes}:${seconds.toString().padStart(2, '0')}`;
       }

       // UI Updates
       function updateUI() {
           document.getElementById("currentScore").textContent = game.score;
           document.getElementById("gameLevel").textContent = game.level;
           
           if (game.score > game.bestScore) {
               game.bestScore = game.score;
               document.getElementById("bestScore").textContent = game.bestScore;
               localStorage.setItem("mazeRunnerBest", game.bestScore);
           }
       }

       // Event listeners
       function setupEventListeners() {
           document.addEventListener("keydown", handleKeyPress);
           
           // Prevent scroll on arrow keys
           window.addEventListener("keydown", function(e) {
               if(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
                   e.preventDefault();
               }
           }, false);
       }

       function handleKeyPress(e) {
           if (game.gameOver) return;
           
           const keyMap = {
               "ArrowUp": "up",
               "ArrowDown": "down", 
               "ArrowLeft": "left",
               "ArrowRight": "right",
               "KeyW": "up",
               "KeyS": "down",
               "KeyA": "left",
               "KeyD": "right"
           };
           
           if (keyMap[e.code]) {
               e.preventDefault();
               movePlayer(keyMap[e.code]);
           } else if (e.code === "Space") {
               e.preventDefault();
               togglePause();
           } else if (e.code === "KeyN") {
               e.preventDefault();
               newGame();
           } else if (e.code === "Enter" && !game.gameRunning) {
               e.preventDefault();
               startGame();
           }
       }

       // Touch controls
       function setupTouchControls() {
           let startX, startY;
           
           game.canvas.addEventListener("touchstart", (e) => {
               startX = e.touches[0].clientX;
               startY = e.touches[0].clientY;
               e.preventDefault();
           });
           
           game.canvas.addEventListener("touchend", (e) => {
               if (!startX || !startY) return;
               
               const endX = e.changedTouches[0].clientX;
               const endY = e.changedTouches[0].clientY;
               
               const deltaX = endX - startX;
               const deltaY = endY - startY;
               
               const minSwipeDistance = 30;
               
               if (Math.abs(deltaX) > Math.abs(deltaY)) {
                   if (Math.abs(deltaX) > minSwipeDistance) {
                       movePlayer(deltaX > 0 ? "right" : "left");
                   }
               } else {
                   if (Math.abs(deltaY) > minSwipeDistance) {
                       movePlayer(deltaY > 0 ? "down" : "up");
                   }
               }
               
               startX = null;
               startY = null;
               e.preventDefault();
           });
       }

       // Modal system
       function showModal(title, message, buttons = []) {
           // Remove existing modal
           const existingModal = document.getElementById("gameModal");
           if (existingModal) existingModal.remove();
           
           const modal = document.createElement("div");
           modal.id = "gameModal";
           modal.innerHTML = `
               <div class="modal-overlay">
                   <div class="modal-content">
                       <h2 class="modal-title">${title}</h2>
                       <p class="modal-message">${message}</p>
                       <div class="modal-buttons">
                           ${buttons.map(btn => 
                               `<button class="modal-button ${btn.primary ? 'primary' : ''}" 
                                onclick="${btn.action.name}(); hideModal();">
                                ${btn.text}
                                </button>`
                           ).join('')}
                       </div>
                   </div>
               </div>
           `;
           
           document.body.appendChild(modal);
       }

       function hideModal() {
           const modal = document.getElementById("gameModal");
           if (modal) modal.remove();
       }

       function showLevelComplete() {
           showModal(
               `🎉 Level ${game.level - 1} Complete!`,
               `Great job! You collected ${game.coinsCollected} coins and scored ${game.score} points!`,
               [
                   { text: "Continue", action: hideModal, primary: true }
               ]
           );
       }

       function showGameOver() {
           game.gameRunning = false;
           game.gameOver = true;
           stopTimer();
           
           const isNewBest = game.score === game.bestScore && game.score > 0;
           
           showModal(
               isNewBest ? "🏆 New Best Score!" : "💀 Game Over",
               `Final Score: ${game.score}<br>Level Reached: ${game.level}<br>Time: ${document.getElementById("gameTime").textContent}`,
               [
                   { text: "Play Again", action: newGame, primary: true },
                   { text: "Share Score", action: shareScore }
               ]
           );
           
           trackEvent("game_over", { 
               score: game.score, 
               level: game.level, 
               time: game.elapsedTime,
               newBest: isNewBest 
           });
       }

       // Additional features
       function showInstructions() {
           showModal(
               "🎯 How to Play Maze Runner",
               `Navigate through the maze using arrow keys or swipe gestures.<br><br>
                🪙 Collect coins for points<br>
                🚪 Reach the green exit to advance<br>
                ⏱️ Faster completion = bonus points<br>
                🏆 Beat your high score!`,
               [
                   { text: "Got it!", action: hideModal, primary: true }
               ]
           );
       }

       function showLeaderboard() {
           const scores = JSON.parse(localStorage.getItem("mazeRunnerScores") || "[]");
           const topScores = scores.sort((a, b) => b.score - a.score).slice(0, 5);
           
           let leaderboardHTML = topScores.length > 0 ? 
               topScores.map((score, index) => 
                   `${index + 1}. ${score.score} pts (Level ${score.level})`
               ).join('<br>') : 
               "No scores yet! Play to set your first record.";
           
           showModal(
               "🏆 Leaderboard",
               leaderboardHTML,
               [
                   { text: "Close", action: hideModal, primary: true }
               ]
           );
       }

       function shareScore() {
           if (navigator.share) {
               navigator.share({
                   title: 'Maze Runner - Check out my score!',
                   text: `I just scored ${game.score} points and reached level ${game.level} in Maze Runner!`,
                   url: window.location.href
               });
           } else {
               // Fallback for browsers without Web Share API
               const text = `I just scored ${game.score} points and reached level ${game.level} in Maze Runner! Play at ${window.location.href}`;
               navigator.clipboard.writeText(text).then(() => {
                   showModal("📋 Copied!", "Score copied to clipboard!", [
                       { text: "OK", action: hideModal, primary: true }
                   ]);
               });
           }
           
           trackEvent("score_shared", { score: game.score, level: game.level });
       }

       function toggleFullscreen() {
           if (!document.fullscreenElement) {
               document.documentElement.requestFullscreen().catch(err => {
                   console.log(`Error attempting to enable fullscreen: ${err.message}`);
               });
           } else {
               document.exitFullscreen();
           }
       }

       // Analytics tracking
       function trackEvent(eventName, properties = {}) {
           // Google Analytics 4 event tracking
           if (typeof gtag !== 'undefined') {
               gtag('event', eventName, {
                   game_name: 'maze_runner',
                   ...properties
               });
           }
           
           // Console log for debugging
           console.log(`📊 Event: ${eventName}`, properties);
       }

       // Save score to local leaderboard
       function saveScore() {
           if (game.score > 0) {
               const scores = JSON.parse(localStorage.getItem("mazeRunnerScores") || "[]");
               scores.push({
                   score: game.score,
                   level: game.level,
                   time: game.elapsedTime,
                   date: new Date().toISOString()
               });
               
               // Keep only top 10 scores
               scores.sort((a, b) => b.score - a.score);
               localStorage.setItem("mazeRunnerScores", JSON.stringify(scores.slice(0, 10)));
           }
       }

       // Add modal styles
       const modalStyles = `
           #gameModal {
               position: fixed;
               top: 0;
               left: 0;
               width: 100%;
               height: 100%;
               z-index: 1000;
           }
           .modal-overlay {
               width: 100%;
               height: 100%;
               background: rgba(0, 0, 0, 0.8);
               display: flex;
               align-items: center;
               justify-content: center;
               backdrop-filter: blur(10px);
           }
           .modal-content {
               background: var(--card-bg);
               border: 2px solid var(--card-border);
               border-radius: 20px;
               padding: 2rem;
               max-width: 400px;
               margin: 1rem;
               text-align: center;
               backdrop-filter: blur(20px);
               box-shadow: var(--shadow-card);
           }
           .modal-title {
               font-family: "Orbitron", monospace;
               font-size: 1.5rem;
               margin-bottom: 1rem;
               color: var(--accent-color);
           }
           .modal-message {
               margin-bottom: 1.5rem;
               line-height: 1.6;
               color: var(--text-secondary);
           }
           .modal-buttons {
               display: flex;
               gap: 1rem;
               justify-content: center;
               flex-wrap: wrap;
           }
           .modal-button {
               padding: 12px 24px;
               background: var(--secondary-gradient);
               border: none;
               border-radius: 8px;
               color: white;
               font-weight: 600;
               cursor: pointer;
               transition: all 0.3s ease;
               font-size: 0.9rem;
           }
           .modal-button:hover {
               transform: translateY(-2px);
               box-shadow: var(--shadow-card);
           }
           .modal-button.primary {
               background: var(--accent-color);
               color: #000;
           }
           .pulse {
               animation: pulse 1s ease-in-out infinite;
           }
           @keyframes pulse {
               0%, 100% { transform: scale(1); }
               50% { transform: scale(1.05); }
           }
       `;
       
       const style = document.createElement('style');
       style.textContent = modalStyles;
       document.head.appendChild(style);

       // Initialize game when page loads
       document.addEventListener("DOMContentLoaded", () => {
           initGame();
       });

       // Prevent zoom on mobile
       let lastTouchEnd = 0;
       document.addEventListener("touchend", function (event) {
           const now = (new Date()).getTime();
           if (now - lastTouchEnd <= 300) {
               event.preventDefault();
           }
           lastTouchEnd = now;
       }, false);

       // Prevent context menu
       document.addEventListener("contextmenu", e => e.preventDefault());

       // Handle page visibility
       document.addEventListener("visibilitychange", () => {
           if (document.hidden && game.gameRunning && !game.gamePaused) {
               togglePause();
           }
       });

       // Handle window resize
       window.addEventListener("resize", () => {
           // Redraw game on resize
           if (game.gameRunning) {
               drawGame();
           }
       });

       console.log("🎮 Maze Runner loaded successfully!");
       
   </script>
</body>
</html>